<?xml version="1.0" encoding="UTF-8"?>
<objectListWrapper>
  <objects>
      <objectContainer>
         <project>
            <name>[BP][Template][OCR]v2.0 11-7-2018</name>
            <description/>
            <author>amironov</author>
            <runs>
               <run>
                  <blockSize>1</blockSize>
                  <campaign>
                     <active>true</active>
                     <businessRules/>
                     <campaignMaps>
                        <campaignMap>
                           <blockSize>1</blockSize>
                           <businessRule>
                              <content>#RuleContext.APPROVE_ALL_RULE</content>
                              <name>Approve All</name>
                              <ruleType>WORKFLOW_RULE</ruleType>
                              <ruleTypeUI>Composite</ruleTypeUI>
                              <uuid>7aef9f86-db70-4434-83e4-4478ab14a8ed</uuid>
                              <workflowRuleMode>SIMPLE</workflowRuleMode>
                           </businessRule>
                           <campaign>
                              <active>false</active>
                              <businessRules/>
                              <campaignMaps/>
                              <campaigns/>
                              <executingType>MACHINE</executingType>
                              <goldBucketBlockSize>0</goldBucketBlockSize>
                              <goldRatio>0</goldRatio>
                              <goldSource>Empty</goldSource>
                              <goldType>Percentage</goldType>
                              <machineConfig>
                                 <answers/>
                                 <content>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- replace with OCR settings from corresponding UC --&gt;
&lt;config charset="UTF-8"&gt;
	&lt;export include-original-data="true"&gt;
	&lt;/export&gt;
&lt;/config&gt;</content>
                                 <description/>
                                 <includedConfigs/>
                                 <inclusionCode>c286e602-47a1-4e62-ae44-a7bdd78c7708</inclusionCode>
                                 <jsonParams>{"configXMLModified":"true"}</jsonParams>
                                 <machineWorkSetting>
                                    <category>
                                       <automation>false</automation>
                                       <description/>
                                       <enabled>true</enabled>
                                       <executingType>MACHINE</executingType>
                                       <name>Other</name>
                                       <private>false</private>
                                       <publicId>dd92f240-144b-4fef-8476-4ec0acbc1105</publicId>
                                    </category>
                                    <contentType>BLANK</contentType>
                                    <description/>
                                    <enabled>true</enabled>
                                    <name>Miscellaneous Tasks</name>
                                    <publicId>26e6e095-00bb-43fa-8c34-af0b18e71ac9</publicId>
                                    <version>
                                       <componentUuid>26e6e095-00bb-43fa-8c34-af0b18e71ac9</componentUuid>
                                       <incrementalVersion>1.0</incrementalVersion>
                                       <lastInChain>true</lastInChain>
                                       <lastModified>2018-07-04T11:58:10Z</lastModified>
                                       <versionUuid>26e6e095-00bb-43fa-8c34-af0b18e71ac9</versionUuid>
                                    </version>
                                    <answers/>
                                    <machineWorkSettingType>BASIC</machineWorkSettingType>
                                    <template>
                                       <content>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config charset="UTF-8"&gt;
	&lt;export include-original-data="true"&gt;
	&lt;/export&gt;
&lt;/config&gt;</content>
                                       <name>Blank</name>
                                       <origination>CREATED_MANUALLY</origination>
                                       <status>ACTIVE</status>
                                       <type>BASE_MACHINE</type>
                                       <uuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</uuid>
                                       <version>
                                          <componentUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</componentUuid>
                                          <incrementalVersion>1.0</incrementalVersion>
                                          <lastInChain>true</lastInChain>
                                          <lastModified>2012-12-27T00:00:00Z</lastModified>
                                          <versionUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</versionUuid>
                                       </version>
                                    </template>
                                 </machineWorkSetting>
                                 <machineWorkSettingType>BASIC</machineWorkSettingType>
                                 <name>replace with Settings </name>
                                 <machineConfigOptions/>
                                 <sourceType>MANUAL</sourceType>
                                 <template>
                                    <content>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config charset="UTF-8"&gt;
	&lt;export include-original-data="true"&gt;
	&lt;/export&gt;
&lt;/config&gt;</content>
                                    <name>Blank</name>
                                    <origination>CREATED_MANUALLY</origination>
                                    <status>ACTIVE</status>
                                    <type>BASE_MACHINE</type>
                                    <uuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</uuid>
                                    <version>
                                       <componentUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</componentUuid>
                                       <incrementalVersion>1.0</incrementalVersion>
                                       <lastInChain>true</lastInChain>
                                       <lastModified>2012-12-27T00:00:00Z</lastModified>
                                       <versionUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</versionUuid>
                                    </version>
                                 </template>
                                 <uuid>c286e602-47a1-4e62-ae44-a7bdd78c7708</uuid>
                                 <version>
                                    <componentUuid>6a7a14b7-7437-4245-9177-96a0c6a609a1</componentUuid>
                                    <incrementalVersion>1.1</incrementalVersion>
                                    <lastInChain>true</lastInChain>
                                    <lastModified>2018-07-11T10:23:40Z</lastModified>
                                    <versionUuid>3e3f2047-994a-4f4d-87c1-69025e5cb635</versionUuid>
                                 </version>
                                 <code/>
                              </machineConfig>
                              <moderation>false</moderation>
                              <origination>CREATED_AUTOMATICALLY</origination>
                              <requiresData>true</requiresData>
                              <status>ACTIVE</status>
                              <streamComplexRunThreshold>1</streamComplexRunThreshold>
                              <streamTimeInterval>Immediately</streamTimeInterval>
                              <streamTimeIntervalValue>0</streamTimeIntervalValue>
                              <streamValueType>Tasks</streamValueType>
                              <title>replace with Settings </title>
                              <type>SINGLE</type>
                              <uuid>9a29a1c8-831d-417e-a6dd-a1ee59069aae</uuid>
                              <validWorkflow>false</validWorkflow>
                              <version>
                                 <componentUuid>5a73ff3b-2d75-482d-a3a1-a8cd5bc5bb2d</componentUuid>
                                 <incrementalVersion>1.1</incrementalVersion>
                                 <lastInChain>true</lastInChain>
                                 <lastModified>2018-07-11T10:33:49Z</lastModified>
                                 <versionUuid>4fb862ab-46ec-41f4-81a3-34906d9b9253</versionUuid>
                              </version>
                              <workSettingBase>false</workSettingBase>
                           </campaign>
                           <deleted>false</deleted>
                           <stepIndex>1</stepIndex>
                           <stepPosition>START</stepPosition>
                           <uuid>29ed8022-f285-4b93-b74a-09b2bb67cfdf</uuid>
                        </campaignMap>
                        <campaignMap>
                           <blockSize>1</blockSize>
                           <businessRule>
                              <content># Rule.Definition={"moderationRule":false,"approveAllRule":false,"splitData":false,"splitRule":false,"splitRuleSuffix":"","joinRule":false,"joinRuleSuffix":"","streamingRule":false,"streamingRuleSuffix":"","namedRule":false,"namedRuleName":""}
package com.freedomoss.requester;

# list any import classes here.
import java.util.Map;
import java.util.ArrayList;
import com.freedomoss.objective.model.CompositeRuleContext;
import com.freedomoss.objective.model.CompositeRuleDataItemContext;
import org.slf4j.Logger;


# declare any global variables here
global CompositeRuleContext source
global Logger log
global Map params


rule "Rule context initialization"
auto-focus true
no-loop
agenda-group "initialization-group"
    when
        $ctx:CompositeRuleContext(initialized == false);
    then
        # insert processed facts into memory
        $ctx.updateWorkingMemory();
        # move to business rules
        kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup("calculation").setFocus();
end

# RuleOutcome.Definition={"outcomeId":"TOOD","conditional":true,"reworkBySameWorker":false,"assignToSameWorker":false,"anableLogging":false,"sendRejectNotification":false,"assignToAnyWorker":false,"approveRelatedAssignments":false,"rejectRelatedAssignments":false,"renameAutomationAnswerItem":false,"conditions":[{"fieldName":"ocr_type","value":"tood","operator":"EQ"}],"customConditions":[]}
rule "1. Send records to 'TOOD' when ocr_type EQ 'tood'"
agenda-group "calculation"
dialect "mvel"
salience 100
    when
        $ctx:CompositeRuleContext(initialized == true);
        $item:CompositeRuleDataItemContext();
        eval($item.checkValue("ocr_type", "EQ", "tood"));

    then
        $ctx.sendResultTo("TOOD", $item);
end

# RuleOutcome.Definition={"outcomeId":"Standard","conditional":true,"reworkBySameWorker":false,"assignToSameWorker":false,"anableLogging":false,"sendRejectNotification":false,"assignToAnyWorker":false,"approveRelatedAssignments":false,"rejectRelatedAssignments":false,"renameAutomationAnswerItem":false,"conditions":[{"fieldName":"ocr_type","value":"standard","operator":"EQ"}],"customConditions":[]}
rule "2. Send records to 'Standard' when ocr_type EQ 'standard'"
agenda-group "calculation"
dialect "mvel"
salience 100
    when
        $ctx:CompositeRuleContext(initialized == true);
        $item:CompositeRuleDataItemContext();
        eval($item.checkValue("ocr_type", "EQ", "standard"));

    then
        $ctx.sendResultTo("Standard", $item);
end



rule "Send unprocessed result to unconditional outcome(s)"
agenda-group "calculation"
dialect "mvel"
salience 80
    when
        $ctx:CompositeRuleContext(initialized == true);
        $item:CompositeRuleDataItemContext();
    then
        $ctx.sendResultToUnconditionalOutcomes($item, true);
end</content>
                              <name>OCR Type</name>
                              <ruleType>WORKFLOW_RULE</ruleType>
                              <ruleTypeUI>Composite</ruleTypeUI>
                              <uuid>1a170e7a-0117-4acd-9e9b-fa90f212a56f</uuid>
                              <workflowRuleMode>SIMPLE</workflowRuleMode>
                           </businessRule>
                           <campaign>
                              <active>false</active>
                              <businessRules/>
                              <campaignMaps/>
                              <campaigns/>
                              <executingType>MACHINE</executingType>
                              <goldBucketBlockSize>0</goldBucketBlockSize>
                              <goldRatio>0</goldRatio>
                              <goldSource>Empty</goldSource>
                              <goldType>Percentage</goldType>
                              <machineConfig>
                                 <answers/>
                                 <content>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- this step needs to be replaced with a sub-BP, created from OCR use case --&gt;
&lt;config charset="UTF-8"&gt;
	&lt;export include-original-data="true"&gt;
	&lt;/export&gt;
&lt;/config&gt;</content>
                                 <description>Replace with OCR UC</description>
                                 <includedConfigs/>
                                 <inclusionCode>23b849bf-cdf0-4d50-b132-1aedf1536ed9</inclusionCode>
                                 <jsonParams>{"configXMLModified":"true"}</jsonParams>
                                 <machineWorkSetting>
                                    <category>
                                       <automation>false</automation>
                                       <description/>
                                       <enabled>true</enabled>
                                       <executingType>MACHINE</executingType>
                                       <name>Other</name>
                                       <private>false</private>
                                       <publicId>dd92f240-144b-4fef-8476-4ec0acbc1105</publicId>
                                    </category>
                                    <contentType>BLANK</contentType>
                                    <description/>
                                    <enabled>true</enabled>
                                    <name>Miscellaneous Tasks</name>
                                    <publicId>26e6e095-00bb-43fa-8c34-af0b18e71ac9</publicId>
                                    <version>
                                       <componentUuid>26e6e095-00bb-43fa-8c34-af0b18e71ac9</componentUuid>
                                       <incrementalVersion>1.0</incrementalVersion>
                                       <lastInChain>true</lastInChain>
                                       <lastModified>2018-07-04T11:58:10Z</lastModified>
                                       <versionUuid>26e6e095-00bb-43fa-8c34-af0b18e71ac9</versionUuid>
                                    </version>
                                    <answers/>
                                    <machineWorkSettingType>BASIC</machineWorkSettingType>
                                    <template>
                                       <content>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config charset="UTF-8"&gt;
	&lt;export include-original-data="true"&gt;
	&lt;/export&gt;
&lt;/config&gt;</content>
                                       <name>Blank</name>
                                       <origination>CREATED_MANUALLY</origination>
                                       <status>ACTIVE</status>
                                       <type>BASE_MACHINE</type>
                                       <uuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</uuid>
                                       <version>
                                          <componentUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</componentUuid>
                                          <incrementalVersion>1.0</incrementalVersion>
                                          <lastInChain>true</lastInChain>
                                          <lastModified>2012-12-27T00:00:00Z</lastModified>
                                          <versionUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</versionUuid>
                                       </version>
                                    </template>
                                 </machineWorkSetting>
                                 <machineWorkSettingType>BASIC</machineWorkSettingType>
                                 <name>replace with OCR sub-bp</name>
                                 <machineConfigOptions/>
                                 <sourceType>MANUAL</sourceType>
                                 <template>
                                    <content>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config charset="UTF-8"&gt;
	&lt;export include-original-data="true"&gt;
	&lt;/export&gt;
&lt;/config&gt;</content>
                                    <name>Blank</name>
                                    <origination>CREATED_MANUALLY</origination>
                                    <status>ACTIVE</status>
                                    <type>BASE_MACHINE</type>
                                    <uuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</uuid>
                                    <version>
                                       <componentUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</componentUuid>
                                       <incrementalVersion>1.0</incrementalVersion>
                                       <lastInChain>true</lastInChain>
                                       <lastModified>2012-12-27T00:00:00Z</lastModified>
                                       <versionUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</versionUuid>
                                    </version>
                                 </template>
                                 <uuid>23b849bf-cdf0-4d50-b132-1aedf1536ed9</uuid>
                                 <version>
                                    <componentUuid>cf4b8949-a0ed-4b8a-a1d3-90a2e6fbc445</componentUuid>
                                    <incrementalVersion>1.1</incrementalVersion>
                                    <lastInChain>true</lastInChain>
                                    <lastModified>2018-07-11T10:23:40Z</lastModified>
                                    <versionUuid>9eb0cec8-30c9-4b6f-bcac-909759d49274</versionUuid>
                                 </version>
                                 <code/>
                              </machineConfig>
                              <moderation>false</moderation>
                              <origination>CREATED_AUTOMATICALLY</origination>
                              <requiresData>true</requiresData>
                              <status>ACTIVE</status>
                              <streamComplexRunThreshold>1</streamComplexRunThreshold>
                              <streamTimeInterval>Immediately</streamTimeInterval>
                              <streamTimeIntervalValue>0</streamTimeIntervalValue>
                              <streamValueType>Tasks</streamValueType>
                              <title>replace with OCR sub-bp</title>
                              <type>SINGLE</type>
                              <uuid>9f06b1db-c727-4efc-b9d4-e6b7623acfdf</uuid>
                              <validWorkflow>false</validWorkflow>
                              <version>
                                 <componentUuid>9f35f35f-f60f-4b54-88ae-e98f09f72862</componentUuid>
                                 <incrementalVersion>1.1</incrementalVersion>
                                 <lastInChain>true</lastInChain>
                                 <lastModified>2018-07-11T10:33:49Z</lastModified>
                                 <versionUuid>8d47b682-7f01-4fd4-8d4f-eb44cf904ac1</versionUuid>
                              </version>
                              <workSettingBase>false</workSettingBase>
                           </campaign>
                           <deleted>false</deleted>
                           <stepIndex>2</stepIndex>
                           <stepPosition>INTERMEDIATE</stepPosition>
                           <uuid>796b9a93-5a5f-4b51-b998-724c800f4e08</uuid>
                        </campaignMap>
                        <campaignMap>
                           <blockSize>1</blockSize>
                           <businessRule>
                              <content>#RuleContext.APPROVE_ALL_RULE</content>
                              <name>Approve All</name>
                              <ruleType>WORKFLOW_RULE</ruleType>
                              <ruleTypeUI>Composite</ruleTypeUI>
                              <uuid>635b551d-e2e4-475e-8bd2-46bf42bfb702</uuid>
                              <workflowRuleMode>SIMPLE</workflowRuleMode>
                           </businessRule>
                           <campaign>
                              <active>false</active>
                              <businessRules/>
                              <campaignMaps/>
                              <campaigns/>
                              <description>Miscellaneous Tasks</description>
                              <executingType>HUMAN</executingType>
                              <goldBucketBlockSize>0</goldBucketBlockSize>
                              <goldRatio>0</goldRatio>
                              <goldSource>Empty</goldSource>
                              <goldType>Percentage</goldType>
                              <moderation>false</moderation>
                              <origination>CREATED_AUTOMATICALLY</origination>
                              <question>
                                 <answers>
                                    <answer>
                                       <allowNA>false</allowNA>
                                       <answer>TOOD</answer>
                                       <answerCode>ocr_document_url</answerCode>
                                       <answerHtml/>
                                       <answerTypeObject>
                                          <answerTypeGroup>ADVANCED</answerTypeGroup>
                                          <code>INFO_EXTRACTION</code>
                                          <description/>
                                          <optionsAvailable>true</optionsAvailable>
                                          <showDefaultValue>true</showDefaultValue>
                                          <showForFieldScheme>false</showForFieldScheme>
                                          <showForHumanTask>true</showForHumanTask>
                                          <showForMachineConfig>false</showForMachineConfig>
                                          <title>Information Extraction</title>
                                          <valueType>SINGLEVALUE</valueType>
                                       </answerTypeObject>
                                       <appendDataStoreOptions>false</appendDataStoreOptions>
                                       <autocompleteField>false</autocompleteField>
                                       <category/>
                                       <constantable>false</constantable>
                                       <defaultValue/>
                                       <doNotNormalizeTaggedText>false</doNotNormalizeTaggedText>
                                       <doNotUseInAdjudication>false</doNotUseInAdjudication>
                                       <findMajorityForAllAtomicValues>false</findMajorityForAllAtomicValues>
                                       <htmlClasses/>
                                       <lastModified>2018-05-29T09:25:58Z</lastModified>
                                       <letCustomValues>false</letCustomValues>
                                       <manualField>false</manualField>
                                       <multiValue>false</multiValue>
                                       <options>{"ieExtractorType":"ORIGINAL_APPEARANCE_EXTRACTOR"}</options>
                                       <originalDocumentSource>${question.data['original_document_url']}</originalDocumentSource>
                                       <percentRequired>false</percentRequired>
                                       <range>false</range>
                                       <required>false</required>
                                       <sequenceNumber>1</sequenceNumber>
                                       <useBlocks>false</useBlocks>
                                       <useEmptyCell>false</useEmptyCell>
                                    </answer>
                                    <answer>
                                       <allowNA>false</allowNA>
                                       <answer>Text</answer>
                                       <answerCode>answ_test_text</answerCode>
                                       <answerHtml/>
                                       <answerTypeObject>
                                          <answerTypeGroup>UNCONSTRAINED_TEXT</answerTypeGroup>
                                          <code>FREE_TEXT</code>
                                          <description/>
                                          <optionsAvailable>false</optionsAvailable>
                                          <showDefaultValue>true</showDefaultValue>
                                          <showForFieldScheme>true</showForFieldScheme>
                                          <showForHumanTask>true</showForHumanTask>
                                          <showForMachineConfig>true</showForMachineConfig>
                                          <title>Free Text</title>
                                          <valueType>SINGLEVALUE</valueType>
                                       </answerTypeObject>
                                       <appendDataStoreOptions>false</appendDataStoreOptions>
                                       <autocompleteField>false</autocompleteField>
                                       <constantable>false</constantable>
                                       <doNotNormalizeTaggedText>false</doNotNormalizeTaggedText>
                                       <doNotUseInAdjudication>false</doNotUseInAdjudication>
                                       <findMajorityForAllAtomicValues>false</findMajorityForAllAtomicValues>
                                       <hotKey>T</hotKey>
                                       <lastModified>2018-06-04T09:38:58Z</lastModified>
                                       <letCustomValues>false</letCustomValues>
                                       <manualField>false</manualField>
                                       <multiValue>false</multiValue>
                                       <parentAnswer>
                                          <allowNA>false</allowNA>
                                          <answer>TOOD</answer>
                                          <answerCode>ocr_document_url</answerCode>
                                          <answerHtml/>
                                          <answerTypeObject>
                                             <answerTypeGroup>ADVANCED</answerTypeGroup>
                                             <code>INFO_EXTRACTION</code>
                                             <description/>
                                             <optionsAvailable>true</optionsAvailable>
                                             <showDefaultValue>true</showDefaultValue>
                                             <showForFieldScheme>false</showForFieldScheme>
                                             <showForHumanTask>true</showForHumanTask>
                                             <showForMachineConfig>false</showForMachineConfig>
                                             <title>Information Extraction</title>
                                             <valueType>SINGLEVALUE</valueType>
                                          </answerTypeObject>
                                          <appendDataStoreOptions>false</appendDataStoreOptions>
                                          <autocompleteField>false</autocompleteField>
                                          <category/>
                                          <constantable>false</constantable>
                                          <defaultValue/>
                                          <doNotNormalizeTaggedText>false</doNotNormalizeTaggedText>
                                          <doNotUseInAdjudication>false</doNotUseInAdjudication>
                                          <findMajorityForAllAtomicValues>false</findMajorityForAllAtomicValues>
                                          <htmlClasses/>
                                          <lastModified>2018-05-29T09:25:58Z</lastModified>
                                          <letCustomValues>false</letCustomValues>
                                          <manualField>false</manualField>
                                          <multiValue>false</multiValue>
                                          <options>{"ieExtractorType":"ORIGINAL_APPEARANCE_EXTRACTOR"}</options>
                                          <originalDocumentSource>${question.data['original_document_url']}</originalDocumentSource>
                                          <percentRequired>false</percentRequired>
                                          <range>false</range>
                                          <required>false</required>
                                          <sequenceNumber>1</sequenceNumber>
                                          <useBlocks>false</useBlocks>
                                          <useEmptyCell>false</useEmptyCell>
                                       </parentAnswer>
                                       <percentRequired>false</percentRequired>
                                       <range>false</range>
                                       <required>true</required>
                                       <sequenceNumber>2</sequenceNumber>
                                       <useBlocks>false</useBlocks>
                                       <useEmptyCell>false</useEmptyCell>
                                    </answer>
                                 </answers>
                                 <assignmentDuration>1800000</assignmentDuration>
                                 <assignmentLimit>1</assignmentLimit>
                                 <attrs>{"lnaa":"Run","lnam":"Tasks","lna":"0"}</attrs>
                                 <autoApprovalDelay>432000000</autoApprovalDelay>
                                 <automaticallyProcessed>0</automaticallyProcessed>
                                 <blockSize>1</blockSize>
                                 <constQualifiedWorkers>false</constQualifiedWorkers>
                                 <currency>USD</currency>
                                 <description>Miscellaneous Tasks</description>
                                 <dynamicTaskRenderingDisabled>true</dynamicTaskRenderingDisabled>
                                 <expiredTime>2592000000</expiredTime>
                                 <faqItems/>
                                 <frameHeight>2500</frameHeight>
                                 <geolocationEnabled>false</geolocationEnabled>
                                 <instructionItems/>
                                 <keywords>Miscellaneous Tasks</keywords>
                                 <maxAssignments>1</maxAssignments>
                                 <moderation>false</moderation>
                                 <moderationFlag>false</moderationFlag>
                                 <origination>CREATED_MANUALLY</origination>
                                 <pendingAssignmentsLimit>10</pendingAssignmentsLimit>
                                 <qualificationInstruction/>
                                 <qualificationRequirements/>
                                 <qualificationRequirementsRequiredForPreview>false</qualificationRequirementsRequiredForPreview>
                                 <qualificationTasks>20</qualificationTasks>
                                 <qualificationTraining>false</qualificationTraining>
                                 <questionRuleMaps>
                                    <questionRuleMap>
                                       <businessRule>
                                          <content>

package com.freedomoss.requester;

#list any import classes here.
import com.freedomoss.objective.model.RuleContext;
import com.freedomoss.objective.model.RuleContext.MajorityType;
import com.freedomoss.objective.model.RuleAssigmentContext;
import com.freedomoss.objective.model.RuleQuestionContext;
import com.freedomoss.requester.model.AwsHitQuestion;
import com.freedomoss.requester.model.AwsHitQuestionItem;
import com.freedomoss.requester.model.AwsHitQuestionAnswerItem;

import org.slf4j.Logger;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;
import java.util.Map;
import java.util.Iterator;

#declare any global variables here
global RuleContext source
global Logger log
global Map params


rule "Rule context initialization"
auto-focus true
no-loop
dialect "mvel"
agenda-group "initialization-group"
	when
		$ctx:RuleContext(initialized == false);
	then
	    # set parameters

        $ctx.properties[RuleContext.MAJORITY_TYPE] =  RuleContext.MajorityType.COUNT;
        $ctx.properties[RuleContext.MAJORITY_VALUE] = new Integer(1);

        #$ctx.properties[RuleContext.MAX_ASSIGNMENT_LIMIT] = new Integer(1);
        $ctx.properties[RuleContext.MAJORITY_HIT_THRESHOLD] = new Double(100/100);
        $ctx.properties[RuleContext.ASSIGNMENT_APPROVE_THRESHOLD] = new Double(0.5);

        # insert processed facts into memory
        $ctx.updateWorkingMemory();
        # move to business rules
        kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup("calculation").setFocus();
        $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Worst accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 70 if gold accuracy goes up &lt; 75 percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp; $campaignStatistic.goldAccuracy &lt; (75/100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 70);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Normal accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 80 if gold accuracy goes up &gt;= 75 percents and &lt; 90"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= (75/ 100) &amp;&amp; $campaignStatistic.goldAccuracy &lt; (90 / 100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 80);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Super accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 95 if gold accuracy goes up &gt;= 90 percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= (90 / 100) )
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 95);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "0. Check, if exist majority"
agenda-group "calculation"
dialect "mvel"
salience 100
no-loop
	when
	    $ctx:RuleContext (initialized == true, $gold:gold, $threshold:properties.MAJORITY_HIT_THRESHOLD)
        eval($ctx.majorityWithoutGold().size() &gt;= ($ctx.questions.size() - $gold.size()) *  $threshold)
	then
		insert(new String("MAJORITY_FOUND"));
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "1. Approve question by majority"
agenda-group "calculation"
dialect "mvel"
salience 90
no-loop
	when
		((String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true))
		or
		(not String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true, assignments.size == properties.MAX_ASSIGNMENT_LIMIT)))
		$rqc:RuleQuestionContext()
	then
		$rqc.approveQuestion($ctx.majority());
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rqc);
end

rule "3. Approve assignment (always)"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		$ctx:RuleContext(initialized == true, $threshold:properties.ASSIGNMENT_APPROVE_THRESHOLD)
		$rac:RuleAssigmentContext()
	then
	    insert(new String("ASSIGNMENT_PROCESSED"));
		$ctx.addApproved($rac);
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rac);
end

rule "5. Extend HIT"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		not String(toString == "MAJORITY_FOUND")
		$ctx:RuleContext(initialized == true, assignments.size &lt; properties.MAX_ASSIGNMENT_LIMIT);
	then
		$ctx.setExtendHit(true);
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

</content>
                                          <name>Start with one assignment 1+0 pay all</name>
                                          <paramValues>{"NORMAL_ACCURACY_LEVEL_SCORE":"80","NORMAL_ACCURACY_LEVEL_UPPER_LIMIT":"90","WORST_ACCURACY_LEVEL_SCORE":"70","MAJORITY_HIT_THRESHOLD":"100","SUPER_ACCURACY_LEVEL_LOWER_LIMIT":"90","WORST_ACCURACY_LEVEL_UPPER_LIMIT":"75","SUPER_ACCURACY_LEVEL_SCORE":"95","NORMAL_ACCURACY_LEVEL_LOWER_LIMIT":"75","MAJORITY_VALUE":"1","CHECK_EVERY":"5","MAX_ASSIGNMENT_LIMIT":"1"}</paramValues>
                                          <ruleType>DROOLS</ruleType>
                                          <ruleTypeUI>Adjudication</ruleTypeUI>
                                          <template>
                                             <content>

package com.freedomoss.requester;

#list any import classes here.
import com.freedomoss.objective.model.RuleContext;
import com.freedomoss.objective.model.RuleContext.MajorityType;
import com.freedomoss.objective.model.RuleAssigmentContext;
import com.freedomoss.objective.model.RuleQuestionContext;
import com.freedomoss.requester.model.AwsHitQuestion;
import com.freedomoss.requester.model.AwsHitQuestionItem;
import com.freedomoss.requester.model.AwsHitQuestionAnswerItem;

import org.slf4j.Logger;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;
import java.util.Map;
import java.util.Iterator;

#declare any global variables here
global RuleContext source
global Logger log
global Map params


rule "Rule context initialization"
auto-focus true
no-loop
dialect "mvel"
agenda-group "initialization-group"
	when
		$ctx:RuleContext(initialized == false);
	then
	    # set parameters

        $ctx.properties[RuleContext.MAJORITY_TYPE] =  RuleContext.MajorityType.COUNT;
        $ctx.properties[RuleContext.MAJORITY_VALUE] = new Integer({{MAJORITY_VALUE}});

        #$ctx.properties[RuleContext.MAX_ASSIGNMENT_LIMIT] = new Integer({{MAX_ASSIGNMENT_LIMIT}});
        $ctx.properties[RuleContext.MAJORITY_HIT_THRESHOLD] = new Double({{MAJORITY_HIT_THRESHOLD}}/100);
        $ctx.properties[RuleContext.ASSIGNMENT_APPROVE_THRESHOLD] = new Double(0.5);

        # insert processed facts into memory
        $ctx.updateWorkingMemory();
        # move to business rules
        kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup("calculation").setFocus();
        $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Worst accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{WORST_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &lt; {{WORST_ACCURACY_LEVEL_UPPER_LIMIT}} percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp; $campaignStatistic.goldAccuracy &lt; ({{WORST_ACCURACY_LEVEL_UPPER_LIMIT}}/100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{WORST_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Normal accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{NORMAL_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &gt;= {{NORMAL_ACCURACY_LEVEL_LOWER_LIMIT}} percents and &lt; {{NORMAL_ACCURACY_LEVEL_UPPER_LIMIT}}"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= ({{NORMAL_ACCURACY_LEVEL_LOWER_LIMIT}}/ 100) &amp;&amp; $campaignStatistic.goldAccuracy &lt; ({{NORMAL_ACCURACY_LEVEL_UPPER_LIMIT}} / 100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{NORMAL_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Super accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{SUPER_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &gt;= {{SUPER_ACCURACY_LEVEL_LOWER_LIMIT}} percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= ({{SUPER_ACCURACY_LEVEL_LOWER_LIMIT}} / 100) )
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{SUPER_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "0. Check, if exist majority"
agenda-group "calculation"
dialect "mvel"
salience 100
no-loop
	when
	    $ctx:RuleContext (initialized == true, $gold:gold, $threshold:properties.MAJORITY_HIT_THRESHOLD)
        eval($ctx.majorityWithoutGold().size() &gt;= ($ctx.questions.size() - $gold.size()) *  $threshold)
	then
		insert(new String("MAJORITY_FOUND"));
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "1. Approve question by majority"
agenda-group "calculation"
dialect "mvel"
salience 90
no-loop
	when
		((String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true))
		or
		(not String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true, assignments.size == properties.MAX_ASSIGNMENT_LIMIT)))
		$rqc:RuleQuestionContext()
	then
		$rqc.approveQuestion($ctx.majority());
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rqc);
end

rule "3. Approve assignment (always)"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		$ctx:RuleContext(initialized == true, $threshold:properties.ASSIGNMENT_APPROVE_THRESHOLD)
		$rac:RuleAssigmentContext()
	then
	    insert(new String("ASSIGNMENT_PROCESSED"));
		$ctx.addApproved($rac);
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rac);
end

rule "5. Extend HIT"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		not String(toString == "MAJORITY_FOUND")
		$ctx:RuleContext(initialized == true, assignments.size &lt; properties.MAX_ASSIGNMENT_LIMIT);
	then
		$ctx.setExtendHit(true);
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

</content>
                                             <description>Get qualified workers: pay if ${MAJORITY_VALUE} correct answers, start with 1 assignment, extend to maximum of ${MAX_ASSIGNMENT_LIMIT} assignments. Set qualification scores depending on gold accuracy.</description>
                                             <name>Start with 1 assignment X+0 rule (pay all)</name>
                                             <params>
                                                <param>
                                                   <code>CHECK_EVERY</code>
                                                   <defaultValue>5</defaultValue>
                                                   <description>Check every i-th gold question when evaluating qualification score</description>
                                                   <name>Check every i-th gold question</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>MAX_ASSIGNMENT_LIMIT</code>
                                                   <defaultValue>1</defaultValue>
                                                   <description>Maximum number of assignments</description>
                                                   <name>Max assignments limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>NORMAL_ACCURACY_LEVEL_SCORE</code>
                                                   <defaultValue>80</defaultValue>
                                                   <description>Qualification score will be given to a worker who has demonstrated a normal accuracy</description>
                                                   <name>Normal accuracy level score</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>NORMAL_ACCURACY_LEVEL_LOWER_LIMIT</code>
                                                   <defaultValue>75</defaultValue>
                                                   <description>Normal accuracy level lower limit in percents inclusive</description>
                                                   <name>Normal accuracy level lower limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>WORST_ACCURACY_LEVEL_UPPER_LIMIT</code>
                                                   <defaultValue>75</defaultValue>
                                                   <description>Worst accuracy level upper limit in percents exclusive, lower limit is considered as 0</description>
                                                   <name>Worst accuracy level upper limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>SUPER_ACCURACY_LEVEL_SCORE</code>
                                                   <defaultValue>95</defaultValue>
                                                   <description>Qualification score will be given to a worker who has demonstrated a super accuracy</description>
                                                   <name>Super accuracy level score</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>MAJORITY_HIT_THRESHOLD</code>
                                                   <defaultValue>100</defaultValue>
                                                   <description>Percent (from 0 to 100) of correct answers when  majority is found</description>
                                                   <name>Percent of correct answers</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>NORMAL_ACCURACY_LEVEL_UPPER_LIMIT</code>
                                                   <defaultValue>90</defaultValue>
                                                   <description>Normal accuracy level upper limit in percents exclusive</description>
                                                   <name>Normal accuracy level upper limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>SUPER_ACCURACY_LEVEL_LOWER_LIMIT</code>
                                                   <defaultValue>90</defaultValue>
                                                   <description>Super accuracy level lower limit in percents inclusive, upper limit is considered as 100</description>
                                                   <name>Super accuracy level lower limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>MAJORITY_VALUE</code>
                                                   <defaultValue>1</defaultValue>
                                                   <description>Number of correct answers</description>
                                                   <name>Majority value</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>WORST_ACCURACY_LEVEL_SCORE</code>
                                                   <defaultValue>70</defaultValue>
                                                   <description>Qualification score will be given to a worker who has demonstrated a low accuracy</description>
                                                   <name>Worst accuracy level score</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                             </params>
                                          </template>
                                          <uuid>84e370ab-7f81-11e8-80bc-0ae8ba3240ae</uuid>
                                          <workflowRuleMode>ADVANCED</workflowRuleMode>
                                       </businessRule>
                                    </questionRuleMap>
                                 </questionRuleMaps>
                                 <radiusSelector>ExactLocation</radiusSelector>
                                 <randomizeAnswers>false</randomizeAnswers>
                                 <recursiveThreshold>1</recursiveThreshold>
                                 <restrictedCountries/>
                                 <taskNotificationSchedule>IMMEDIATE</taskNotificationSchedule>
                                 <templates>
                                    <template>
                                       <code/>
                                       <content>&lt;#include "extras.ftl" parse=true/&gt;
&lt;#include "html.ftl" parse=true/&gt;
&lt;#include "answers.ftl" parse=true/&gt;
&lt;#assign FEEDBACK_ENABLED = true&gt;
&lt;!-- v 1.9 --&gt;
&lt;@hit contentCss="${applicationResourceUrl}/workfusion-resources/saas/ms/ms.bootstrap.min.css"&gt;
&lt;@script src="${applicationResourceUrl}/workfusion-resources/bootstrap/js/bootstrap-tab.js"/&gt;  
  
&lt;style type="text/css"&gt;
    document {
        background: none !important;
        overflow: visible!important;
        padding: 0 !important;
        position: absolute !important;
        left: 0;
        top: 0;
        width: 100%;
    }
    page {
        box-shadow: none !important;
        background: none !important;
        padding: 0 !important;
        margin: 0 !important;
        overflow: visible!important;
        height: 0 !important;
    }
    cell, document td {
        border: 0 !important;
    }
    block[blocktype="Picture"] {
        opacity: 1 !important;
        background: none !important;
    }
    .hidden_field {display:none; }
    .hidden {display:inline-block !important;}
    .extraction-content {padding: 0 !important;}
  	.ie-view-source {
  		display: none;
  	}
  	.ie-view-source + .ie-zoom-in-zoom-out-separator {
  		display: none !important;
  	}
  	.popup-original-document.ml10 {
  		margin-left: 0 !important;
  	}
    .opacity-control {
        float: left;
        line-height: 40px;
        margin-left: 3px;
    }
    .opacity-control span {
        display: inline-block;
    }
    #rangeInput {
        width: 100px;
        box-shadow: none;
        margin: -1px 0 0 10px;
        border: 0;
    }
    #rangeInput::-moz-focus-outer {
        border: 0;
    }
&lt;/style&gt;
 
&lt;script type="text/javascript"&gt;
    $(document).ready(function() {
        
        if (document.getElementsByClassName('submit-btn').length) {
            var originalSubmitEvent = document.getElementsByClassName('submit-btn')[0].onclick;
            document.getElementsByClassName('submit-btn')[0].onclick = function(){
                preprocessAppendOrder();
                originalSubmitEvent();
            }
        }
       
        var originalOnTextContainerLoad = ExtractionAnswerController.prototype.onTextContainerLoad;
        ExtractionAnswerController.prototype.onTextContainerLoad = function() {
            try {
            originalOnTextContainerLoad.apply(this, arguments);
            scrollingDiv=document.getElementsByClassName('extraction-body')[0];
          	divTop = scrollingDiv.offsetTop;
            while (scrollingDiv.offsetParent) {
            	scrollingDiv = scrollingDiv.offsetParent;
                divTop += scrollingDiv.offsetTop;
            }
            scrollingDiv=document.getElementsByClassName('extraction-body')[0];
            divArray = scrollingDiv.getElementsByTagName("div");
            divSizes(null);
            document.onscroll=divSizes;
            scrollingDiv.onscroll=divSizes;
            document.onkeyup=keyupHandler;
            scrollingDiv.onkeyup=keyupHandler;
            var minusButton=document.getElementsByClassName('ie-zoom-in')[0];
            var plusButton=document.getElementsByClassName('ie-zoom-out')[0];
            minusButton.onclick=out;
            plusButton.onclick=in;
            var $textContainer = ExtractionAnswer.getExtractionController().$textContainer;
            console.log("Before if");
            if ($textContainer.find('document')) {
            	console.log("Before init");
                initOpacity();
            	console.log("After init");
              	var $page = $textContainer.find('page').eq(0);
                scale = parseFloat((1/(parseInt($page.attr('width'))/$page.width())).toFixed(1));
                $textContainer.css({'transform':'scaleX(' + scale +') scaleY(' + scale + ') translateZ(0)'});
      		}
            } catch (e){
              console.log("onTextContainerLoad "+e);
            }
        };
    });
  
    var OpacityElements = {
        image: $([]),
        textContainer: $([])
    };
  
    function out(){
    	scale=scale-scale*0.1;
        zoom(scale);
    }
  
    function in(){
    	scale=scale+scale*0.1;
        zoom(scale);
    }
  
    function zoom(scale){
        var $textContainer = ExtractionAnswer.getExtractionController().$textContainer;
		$textContainer.css({'transform':'scaleX(' + scale +') scaleY(' + scale + ') translateZ(0)'});
    }
  
    function keyupHandler(){
       try {
         if (event.keyCode==67){
         	document.getElementById('checkInput').checked=!document.getElementById('checkInput').checked;
            if (document.getElementById('checkInput').checked) {
              OpacityElements.image.css('opacity', 1);
        	} else {
              OpacityElements.image.css('opacity', 0);
        	}

            var divArray=scrollingDiv.getElementsByClassName("n");
        	var i;
        	for (i in divArray) {
          		var divWithText = divArray[i];
      			if (document.getElementById('checkInput').checked) {
              		divWithText.style.opacity="0";
        		} else {
              		divWithText.style.opacity="1";
        		}
        	}
         }
       } catch (e){
       }
    }
  
	var scale = 1;
    var divTop;
    var divArray;
    var scrollingDiv;
    var isComputing = false;
    var counter = 0;
    var isWidthChanged = false;
    var elementSet = new Set();

    function divSizes(ev) {
    	if (!isComputing) {
        	counter++;
            isComputing = true;
            try {
                if (ev!=null)
                	ev.cancelBubble=true;
            	
                var i;
                isWidthChanged = false;
                for (i in divArray) {
                	try {
                    	var divWithText = divArray[i];
                    	if (!elementSet.has(divWithText)) {
                        	if (elementInViewport(divWithText)) {
                        		divSize(divWithText);
                        	}
                    	}
                    } catch (ex) {
                    }
                }
            } catch (e) {
            }
            isComputing = false;
        }
    }

                    function divSize(divWithText) {
                    	try {
                    		if (divWithText.className == "n") {
                    			var divWithTextFontHeight = divWithText.style.fontSize.replace("px", "");
                    			var divWithTextWidth = divWithText.style.width.replace("px", "");
                    			var divWithTextScrollWidth = divWithText.scrollWidth;
                    			var divWithTextHeight = divWithText.style.height.replace("px", "");
                    			var divWithTextScrollHeight = divWithText.scrollHeight;
                                var widthDiff=divWithTextScrollWidth-divWithTextWidth;
                                var heightDiff=divWithTextScrollHeight-divWithTextHeight;

                              if ((widthDiff&gt;0) || (heightDiff&gt;0)) {
                    				var updatedFontSizeWidth = divWithTextFontHeight * divWithTextWidth / divWithTextScrollWidth;
                    				var updatedFontSizeHeight = divWithTextFontHeight * divWithTextHeight / divWithTextScrollHeight;
                    				var updatedFontSize = Math.min(updatedFontSizeWidth, updatedFontSizeHeight);
                    				divWithText.style.fontSize = updatedFontSize + "px";
                          			elementSet.add(divWithText);
                    				isWidthChanged = true;
                    			}
                    		}
                    	}
                    	catch (e) {
                    	}
                    }

                    function elementInViewport(inputElement) {
                      	try{

                        var startInputElement=inputElement;  
                      	var top = inputElement.offsetTop;
                    	var height = inputElement.offsetHeight;
                    	while (inputElement.offsetParent) {
                    		inputElement = inputElement.offsetParent;
                    		top += inputElement.offsetTop;
                    	}
                        var windowPageYOffset=window.pageYOffset+scrollingDiv.scrollTop+divTop;
                        return (top &gt;= windowPageYOffset &amp;&amp; /*left &gt;= windowPageXOffset &amp;&amp;*/ (top + height) &lt;= (windowPageYOffset/10*15 + window.innerHeight*3) /*&amp;&amp; (left + width) &lt;= (windowPageXOffset + frameWindow.innerWidth)*/);
                        } catch (e){
                        	return false;
                        }
                    }

   
    function initOpacity() {
        try {
       	console.log("Init start");
        document.getElementsByClassName('ie-zoom-out')[0].outerHTML=document.getElementsByClassName('ie-zoom-out')[0].outerHTML+'&lt;div class="toolbar-boundary"&gt;&lt;/div&gt;&lt;div class="opacity-control"&gt;&lt;label accesskey="c"&gt;Original document:&lt;/label&gt;&lt;input type="checkbox" id="checkInput" value="yes"/&gt;&lt;/div&gt;';
       	console.log("After get");
        OpacityElements.image = $('.extraction-content img');
        OpacityElements.textContainer = $('.extraction-content page');
      	OpacityElements.image.css('opacity', 0);
        $('#checkInput').on('click', changeOpacity);
        document.getElementById('checkInput').focus();
        var divArray=scrollingDiv.getElementsByClassName("n");
        var i;
        for (i in divArray) {
          try{
          var divWithText = divArray[i];
          divWithText.style.opacity="1";
          } catch (e){
          }
        }
        } catch (ex){
        	console.log("Init "+ex);
        }
    }
   
    function changeOpacity() {
        try {
        var i;
        var divArray=scrollingDiv.getElementsByClassName("n");
      		if (this.checked) {
              OpacityElements.image.css('opacity', 1);
        	} else {
              OpacityElements.image.css('opacity', 0);
        	}
        for (i in divArray) {
          var divWithText = divArray[i];
      		if (this.checked) {
              divWithText.style.opacity="0";
        	} else {
              divWithText.style.opacity="1";
        	}
        }
        } catch (e){
        }
    }
   
    function preprocessAppendOrder() {
        var appendOrder = 0;
        var controllers = Answers.getTaggingControllers();
        controllers.forEach(function(controller) {
            var $tags = DocumentContainer.getControllerTag(controller);
            if ($tags.length) {
                for (var i = 0, l = $tags.length; i &lt; l; i++) {
                    $tags.eq(i).attr('appendorder', nextAppendOrder());
                }
            }
        });
       
        function nextAppendOrder () {
            return ++appendOrder;
        }
    }
&lt;/script&gt;
  
&lt;@instructions title="&lt;h3 id='TaggingOverOriginalDocument-Step6:[TOOD][HT][BASE]TaggingOverOriginalDocument'&gt;[TOOD][MT][BASE] Tagging Over Original Document&lt;/h3&gt;"&gt;
  &lt;!--- editable content --&gt;
  &lt;@editable id="__INSTRUCTIONS__"&gt;&lt;br&gt;&lt;br&gt;&lt;/@editable&gt;
&lt;/@instructions&gt;
&lt;@form&gt;
&lt;#if questions??&gt;
    &lt;div class="thumbnail"&gt;
    &lt;#list questions as question&gt;
      &lt;@report question=question includeAll=true/&gt;
      &lt;div style="position:relative;margin:2px 0px" class="block question"&gt;
           &lt;div style="position:absolute;top:0px;right:0px;background-color:#e0e0e0;padding:1px 4px;border: 1px solid #C0C0C0;border-radius: 0px" class="number"&gt;
                &lt;b&gt;${question_index + 1}&lt;/b&gt;
           &lt;/div&gt;
           &lt;div&gt;
               &lt;div class="place bg-dark"&gt;
                 &lt;@editable id="__DATA__"&gt;&lt;br data-mce-bogus="1"&gt;&lt;/@editable&gt;
               &lt;/div&gt;
               &lt;div class="place"&gt;
                 &lt;@answers question=question/&gt;
               &lt;/div&gt;
            &lt;/div&gt;
      &lt;/div&gt;
    &lt;/#list&gt;
    &lt;/div&gt;
&lt;/#if&gt;
&lt;@submit text="Submit" /&gt;
&lt;/@form&gt;
&lt;/@hit&gt;</content>
                                       <name>[TOOD] Document Tagging Sample</name>
                                       <origination>CREATED_AUTOMATICALLY</origination>
                                       <status>ACTIVE</status>
                                       <type>TASK</type>
                                       <uuid>7b12f633-0836-4afe-b029-8a566fd4fe57</uuid>
                                       <version>
                                          <componentUuid>31fd0d05-0791-4083-b461-db3324593e33</componentUuid>
                                          <incrementalVersion>1.1</incrementalVersion>
                                          <lastInChain>true</lastInChain>
                                          <lastModified>2018-07-11T10:23:40Z</lastModified>
                                          <versionUuid>b067b09c-3874-4e21-84d5-34634cc68420</versionUuid>
                                       </version>
                                    </template>
                                 </templates>
                                 <title>[TOOD][MT][BASE] Tagging Over Original Document</title>
                                 <useCommonHitCoordinates>true</useCommonHitCoordinates>
                                 <uuid>137fcdcc-eae5-47d0-a0e4-747acd340ecd</uuid>
                                 <version>
                                    <componentUuid>bf1e2eae-20ae-4948-9aaa-43716e85d596</componentUuid>
                                    <incrementalVersion>1.1</incrementalVersion>
                                    <lastInChain>true</lastInChain>
                                    <lastModified>2018-07-11T10:23:40Z</lastModified>
                                    <versionUuid>34080ef0-322e-41fb-a843-1aee1d78c056</versionUuid>
                                 </version>
                                 <workSetting>
                                    <category>
                                       <automation>false</automation>
                                       <description/>
                                       <enabled>true</enabled>
                                       <executingType>HUMAN</executingType>
                                       <name>Other</name>
                                       <private>false</private>
                                       <publicId>dd92f240-144b-4fef-8476-4ec0acbc1104</publicId>
                                    </category>
                                    <contentType>BLANK</contentType>
                                    <description/>
                                    <enabled>true</enabled>
                                    <name>Miscellaneous Tasks</name>
                                    <publicId>26e6e095-00bb-43fa-8c34-af0b18e71ac8</publicId>
                                    <version>
                                       <componentUuid>26e6e095-00bb-43fa-8c34-af0b18e71ac8</componentUuid>
                                       <incrementalVersion>1.0</incrementalVersion>
                                       <lastInChain>true</lastInChain>
                                       <lastModified>2018-07-04T11:58:04Z</lastModified>
                                       <versionUuid>26e6e095-00bb-43fa-8c34-af0b18e71ac8</versionUuid>
                                    </version>
                                    <answers/>
                                    <businessRules>
                                       <businessRule>
                                          <content>

package com.freedomoss.requester;

#list any import classes here.
import com.freedomoss.objective.model.RuleContext;
import com.freedomoss.objective.model.RuleContext.MajorityType;
import com.freedomoss.objective.model.RuleAssigmentContext;
import com.freedomoss.objective.model.RuleQuestionContext;
import com.freedomoss.requester.model.AwsHitQuestion;
import com.freedomoss.requester.model.AwsHitQuestionItem;
import com.freedomoss.requester.model.AwsHitQuestionAnswerItem;

import org.slf4j.Logger;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;
import java.util.Map;
import java.util.Iterator;

#declare any global variables here
global RuleContext source
global Logger log
global Map params


rule "Rule context initialization"
auto-focus true
no-loop
dialect "mvel"
agenda-group "initialization-group"
	when
		$ctx:RuleContext(initialized == false);
	then
	    # set parameters

        $ctx.properties[RuleContext.MAJORITY_TYPE] =  RuleContext.MajorityType.COUNT;
        $ctx.properties[RuleContext.MAJORITY_VALUE] = new Integer(1);

        #$ctx.properties[RuleContext.MAX_ASSIGNMENT_LIMIT] = new Integer(1);
        $ctx.properties[RuleContext.MAJORITY_HIT_THRESHOLD] = new Double(100/100);
        $ctx.properties[RuleContext.ASSIGNMENT_APPROVE_THRESHOLD] = new Double(0.5);

        # insert processed facts into memory
        $ctx.updateWorkingMemory();
        # move to business rules
        kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup("calculation").setFocus();
        $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Worst accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 70 if gold accuracy goes up &lt; 75 percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp; $campaignStatistic.goldAccuracy &lt; (75/100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 70);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Normal accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 80 if gold accuracy goes up &gt;= 75 percents and &lt; 90"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= (75/ 100) &amp;&amp; $campaignStatistic.goldAccuracy &lt; (90 / 100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 80);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Super accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 95 if gold accuracy goes up &gt;= 90 percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= (90 / 100) )
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 95);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "0. Check, if exist majority"
agenda-group "calculation"
dialect "mvel"
salience 100
no-loop
	when
	    $ctx:RuleContext (initialized == true, $gold:gold, $threshold:properties.MAJORITY_HIT_THRESHOLD)
        eval($ctx.majorityWithoutGold().size() &gt;= ($ctx.questions.size() - $gold.size()) *  $threshold)
	then
		insert(new String("MAJORITY_FOUND"));
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "1. Approve question by majority"
agenda-group "calculation"
dialect "mvel"
salience 90
no-loop
	when
		((String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true))
		or
		(not String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true, assignments.size == properties.MAX_ASSIGNMENT_LIMIT)))
		$rqc:RuleQuestionContext()
	then
		$rqc.approveQuestion($ctx.majority());
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rqc);
end

rule "3. Approve assignment (always)"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		$ctx:RuleContext(initialized == true, $threshold:properties.ASSIGNMENT_APPROVE_THRESHOLD)
		$rac:RuleAssigmentContext()
	then
	    insert(new String("ASSIGNMENT_PROCESSED"));
		$ctx.addApproved($rac);
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rac);
end

rule "5. Extend HIT"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		not String(toString == "MAJORITY_FOUND")
		$ctx:RuleContext(initialized == true, assignments.size &lt; properties.MAX_ASSIGNMENT_LIMIT);
	then
		$ctx.setExtendHit(true);
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

</content>
                                          <name>Start with one assignment 1+0 pay all</name>
                                          <paramValues>{"NORMAL_ACCURACY_LEVEL_SCORE":"80","NORMAL_ACCURACY_LEVEL_UPPER_LIMIT":"90","WORST_ACCURACY_LEVEL_SCORE":"70","MAJORITY_HIT_THRESHOLD":"100","SUPER_ACCURACY_LEVEL_LOWER_LIMIT":"90","WORST_ACCURACY_LEVEL_UPPER_LIMIT":"75","SUPER_ACCURACY_LEVEL_SCORE":"95","NORMAL_ACCURACY_LEVEL_LOWER_LIMIT":"75","MAJORITY_VALUE":"1","CHECK_EVERY":"5","MAX_ASSIGNMENT_LIMIT":"1"}</paramValues>
                                          <ruleType>DROOLS</ruleType>
                                          <ruleTypeUI>Adjudication</ruleTypeUI>
                                          <template>
                                             <content>

package com.freedomoss.requester;

#list any import classes here.
import com.freedomoss.objective.model.RuleContext;
import com.freedomoss.objective.model.RuleContext.MajorityType;
import com.freedomoss.objective.model.RuleAssigmentContext;
import com.freedomoss.objective.model.RuleQuestionContext;
import com.freedomoss.requester.model.AwsHitQuestion;
import com.freedomoss.requester.model.AwsHitQuestionItem;
import com.freedomoss.requester.model.AwsHitQuestionAnswerItem;

import org.slf4j.Logger;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;
import java.util.Map;
import java.util.Iterator;

#declare any global variables here
global RuleContext source
global Logger log
global Map params


rule "Rule context initialization"
auto-focus true
no-loop
dialect "mvel"
agenda-group "initialization-group"
	when
		$ctx:RuleContext(initialized == false);
	then
	    # set parameters

        $ctx.properties[RuleContext.MAJORITY_TYPE] =  RuleContext.MajorityType.COUNT;
        $ctx.properties[RuleContext.MAJORITY_VALUE] = new Integer({{MAJORITY_VALUE}});

        #$ctx.properties[RuleContext.MAX_ASSIGNMENT_LIMIT] = new Integer({{MAX_ASSIGNMENT_LIMIT}});
        $ctx.properties[RuleContext.MAJORITY_HIT_THRESHOLD] = new Double({{MAJORITY_HIT_THRESHOLD}}/100);
        $ctx.properties[RuleContext.ASSIGNMENT_APPROVE_THRESHOLD] = new Double(0.5);

        # insert processed facts into memory
        $ctx.updateWorkingMemory();
        # move to business rules
        kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup("calculation").setFocus();
        $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Worst accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{WORST_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &lt; {{WORST_ACCURACY_LEVEL_UPPER_LIMIT}} percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp; $campaignStatistic.goldAccuracy &lt; ({{WORST_ACCURACY_LEVEL_UPPER_LIMIT}}/100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{WORST_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Normal accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{NORMAL_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &gt;= {{NORMAL_ACCURACY_LEVEL_LOWER_LIMIT}} percents and &lt; {{NORMAL_ACCURACY_LEVEL_UPPER_LIMIT}}"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= ({{NORMAL_ACCURACY_LEVEL_LOWER_LIMIT}}/ 100) &amp;&amp; $campaignStatistic.goldAccuracy &lt; ({{NORMAL_ACCURACY_LEVEL_UPPER_LIMIT}} / 100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{NORMAL_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Super accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{SUPER_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &gt;= {{SUPER_ACCURACY_LEVEL_LOWER_LIMIT}} percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= ({{SUPER_ACCURACY_LEVEL_LOWER_LIMIT}} / 100) )
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{SUPER_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "0. Check, if exist majority"
agenda-group "calculation"
dialect "mvel"
salience 100
no-loop
	when
	    $ctx:RuleContext (initialized == true, $gold:gold, $threshold:properties.MAJORITY_HIT_THRESHOLD)
        eval($ctx.majorityWithoutGold().size() &gt;= ($ctx.questions.size() - $gold.size()) *  $threshold)
	then
		insert(new String("MAJORITY_FOUND"));
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "1. Approve question by majority"
agenda-group "calculation"
dialect "mvel"
salience 90
no-loop
	when
		((String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true))
		or
		(not String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true, assignments.size == properties.MAX_ASSIGNMENT_LIMIT)))
		$rqc:RuleQuestionContext()
	then
		$rqc.approveQuestion($ctx.majority());
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rqc);
end

rule "3. Approve assignment (always)"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		$ctx:RuleContext(initialized == true, $threshold:properties.ASSIGNMENT_APPROVE_THRESHOLD)
		$rac:RuleAssigmentContext()
	then
	    insert(new String("ASSIGNMENT_PROCESSED"));
		$ctx.addApproved($rac);
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rac);
end

rule "5. Extend HIT"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		not String(toString == "MAJORITY_FOUND")
		$ctx:RuleContext(initialized == true, assignments.size &lt; properties.MAX_ASSIGNMENT_LIMIT);
	then
		$ctx.setExtendHit(true);
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

</content>
                                             <description>Get qualified workers: pay if ${MAJORITY_VALUE} correct answers, start with 1 assignment, extend to maximum of ${MAX_ASSIGNMENT_LIMIT} assignments. Set qualification scores depending on gold accuracy.</description>
                                             <name>Start with 1 assignment X+0 rule (pay all)</name>
                                             <params>
                                                <param>
                                                   <code>CHECK_EVERY</code>
                                                   <defaultValue>5</defaultValue>
                                                   <description>Check every i-th gold question when evaluating qualification score</description>
                                                   <name>Check every i-th gold question</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>MAX_ASSIGNMENT_LIMIT</code>
                                                   <defaultValue>1</defaultValue>
                                                   <description>Maximum number of assignments</description>
                                                   <name>Max assignments limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>NORMAL_ACCURACY_LEVEL_SCORE</code>
                                                   <defaultValue>80</defaultValue>
                                                   <description>Qualification score will be given to a worker who has demonstrated a normal accuracy</description>
                                                   <name>Normal accuracy level score</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>NORMAL_ACCURACY_LEVEL_LOWER_LIMIT</code>
                                                   <defaultValue>75</defaultValue>
                                                   <description>Normal accuracy level lower limit in percents inclusive</description>
                                                   <name>Normal accuracy level lower limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>WORST_ACCURACY_LEVEL_UPPER_LIMIT</code>
                                                   <defaultValue>75</defaultValue>
                                                   <description>Worst accuracy level upper limit in percents exclusive, lower limit is considered as 0</description>
                                                   <name>Worst accuracy level upper limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>SUPER_ACCURACY_LEVEL_SCORE</code>
                                                   <defaultValue>95</defaultValue>
                                                   <description>Qualification score will be given to a worker who has demonstrated a super accuracy</description>
                                                   <name>Super accuracy level score</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>MAJORITY_HIT_THRESHOLD</code>
                                                   <defaultValue>100</defaultValue>
                                                   <description>Percent (from 0 to 100) of correct answers when  majority is found</description>
                                                   <name>Percent of correct answers</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>NORMAL_ACCURACY_LEVEL_UPPER_LIMIT</code>
                                                   <defaultValue>90</defaultValue>
                                                   <description>Normal accuracy level upper limit in percents exclusive</description>
                                                   <name>Normal accuracy level upper limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>SUPER_ACCURACY_LEVEL_LOWER_LIMIT</code>
                                                   <defaultValue>90</defaultValue>
                                                   <description>Super accuracy level lower limit in percents inclusive, upper limit is considered as 100</description>
                                                   <name>Super accuracy level lower limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>MAJORITY_VALUE</code>
                                                   <defaultValue>1</defaultValue>
                                                   <description>Number of correct answers</description>
                                                   <name>Majority value</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>WORST_ACCURACY_LEVEL_SCORE</code>
                                                   <defaultValue>70</defaultValue>
                                                   <description>Qualification score will be given to a worker who has demonstrated a low accuracy</description>
                                                   <name>Worst accuracy level score</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                             </params>
                                          </template>
                                          <uuid>84e370ab-7f81-11e8-80bc-0ae8ba3240ae</uuid>
                                          <workflowRuleMode>ADVANCED</workflowRuleMode>
                                       </businessRule>
                                    </businessRules>
                                    <isPrivate>false</isPrivate>
                                    <items>
                                       <item>
                                          <type>HIT_EXPIRES_IN</type>
                                          <value>2592000000</value>
                                       </item>
                                       <item>
                                          <type>AUTOMATICALLY_APPROVED</type>
                                          <value>432000000</value>
                                       </item>
                                       <item>
                                          <type>RECOMMENDATION_TAGS</type>
                                          <value>["information_extraction"]</value>
                                       </item>
                                       <item>
                                          <type>TIME_PER_ASSIGNMENT</type>
                                          <value>1800000</value>
                                       </item>
                                       <item>
                                          <type>TITLE</type>
                                          <value>Miscellaneous Tasks</value>
                                       </item>
                                    </items>
                                    <template>
                                       <code/>
                                       <content>&lt;#include "extras.ftl" parse=true/&gt;
&lt;#include "html.ftl" parse=true/&gt;
&lt;#include "answers.ftl" parse=true/&gt;
&lt;#assign FEEDBACK_ENABLED = true&gt;

&lt;@hit contentCss="${applicationResourceUrl}/workfusion-resources/saas/ms/ms.bootstrap.min.css"&gt;
&lt;@script src="${applicationResourceUrl}/workfusion-resources/bootstrap/js/bootstrap-tab.js"/&gt;  
  

  
&lt;@instructions title="&lt;h2&gt;BLANK&lt;/h2&gt;"&gt;
  &lt;!--- editable content --&gt;
  &lt;@editable id="__INSTRUCTIONS__"&gt;&lt;br&gt;&lt;br&gt;&lt;/@editable&gt;
&lt;/@instructions&gt;
&lt;@form&gt;
&lt;#if questions??&gt;
    &lt;div class="thumbnail"&gt;
    &lt;#list questions as question&gt;
      &lt;@report question=question includeAll=true/&gt;
      &lt;div style="position:relative;margin:2px 0px" class="block question"&gt;
           &lt;div style="position:absolute;top:0px;right:0px;background-color:#e0e0e0;padding:1px 4px;border: 1px solid #C0C0C0;border-radius: 0px" class="number"&gt;
                &lt;b&gt;${question_index + 1}&lt;/b&gt;
           &lt;/div&gt;
           &lt;div&gt;
               &lt;div class="place bg-dark"&gt;
                 &lt;@editable id="__DATA__"&gt;${question.data.blank} &lt;br&gt;&lt;br&gt;&lt;/@editable&gt;
               &lt;/div&gt;
               &lt;div class="place"&gt;
                 &lt;@answers question=question/&gt;
               &lt;/div&gt;
            &lt;/div&gt;
      &lt;/div&gt;
    &lt;/#list&gt;
    &lt;/div&gt;
&lt;/#if&gt;
&lt;@submit text="Submit" /&gt;
&lt;/@form&gt;
&lt;/@hit&gt;</content>
                                       <name>Blank</name>
                                       <origination>CREATED_MANUALLY</origination>
                                       <status>ACTIVE</status>
                                       <type>BASE</type>
                                       <uuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc3</uuid>
                                       <version>
                                          <componentUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc3</componentUuid>
                                          <incrementalVersion>1.0</incrementalVersion>
                                          <lastInChain>true</lastInChain>
                                          <lastModified>2012-12-27T00:00:00Z</lastModified>
                                          <versionUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc3</versionUuid>
                                       </version>
                                    </template>
                                 </workSetting>
                              </question>
                              <requiresData>true</requiresData>
                              <status>ACTIVE</status>
                              <streamComplexRunThreshold>1</streamComplexRunThreshold>
                              <streamTimeInterval>Immediately</streamTimeInterval>
                              <streamTimeIntervalValue>0</streamTimeIntervalValue>
                              <streamValueType>Tasks</streamValueType>
                              <title>[TOOD][MT][BASE] Tagging Over Original Document</title>
                              <type>SINGLE</type>
                              <uuid>c7dad6e9-dadb-4a47-b46f-ef5c73c9b31d</uuid>
                              <validWorkflow>false</validWorkflow>
                              <version>
                                 <componentUuid>62191fd1-b81f-40d6-8580-7d98d088d0d1</componentUuid>
                                 <incrementalVersion>1.2</incrementalVersion>
                                 <lastInChain>true</lastInChain>
                                 <lastModified>2018-07-11T10:23:40Z</lastModified>
                                 <versionUuid>3e3d9887-ac29-4906-9463-4b6a5a3d4fe4</versionUuid>
                              </version>
                              <workSettingBase>false</workSettingBase>
                           </campaign>
                           <deleted>false</deleted>
                           <stepIndex>3</stepIndex>
                           <stepPosition>INTERMEDIATE</stepPosition>
                           <uuid>bd66d3f5-8bad-4abe-aae9-fc58feb18bb7</uuid>
                        </campaignMap>
                        <campaignMap>
                           <blockSize>1</blockSize>
                           <businessRule>
                              <content>#RuleContext.APPROVE_ALL_RULE</content>
                              <name>Approve All</name>
                              <ruleType>WORKFLOW_RULE</ruleType>
                              <ruleTypeUI>Composite</ruleTypeUI>
                              <uuid>425bbd48-1668-4688-a96e-438caa9e4a17</uuid>
                              <workflowRuleMode>SIMPLE</workflowRuleMode>
                           </businessRule>
                           <campaign>
                              <active>false</active>
                              <businessRules/>
                              <campaignMaps/>
                              <campaigns/>
                              <description>Miscellaneous Tasks</description>
                              <executingType>HUMAN</executingType>
                              <goldBucketBlockSize>0</goldBucketBlockSize>
                              <goldRatio>0</goldRatio>
                              <goldSource>Empty</goldSource>
                              <goldType>Percentage</goldType>
                              <moderation>false</moderation>
                              <origination>CREATED_AUTOMATICALLY</origination>
                              <question>
                                 <answers>
                                    <answer>
                                       <allowNA>false</allowNA>
                                       <answer>Standard</answer>
                                       <answerCode>ocr_document_url</answerCode>
                                       <answerHtml/>
                                       <answerTypeObject>
                                          <answerTypeGroup>ADVANCED</answerTypeGroup>
                                          <code>INFO_EXTRACTION</code>
                                          <description/>
                                          <optionsAvailable>true</optionsAvailable>
                                          <showDefaultValue>true</showDefaultValue>
                                          <showForFieldScheme>false</showForFieldScheme>
                                          <showForHumanTask>true</showForHumanTask>
                                          <showForMachineConfig>false</showForMachineConfig>
                                          <title>Information Extraction</title>
                                          <valueType>SINGLEVALUE</valueType>
                                       </answerTypeObject>
                                       <appendDataStoreOptions>false</appendDataStoreOptions>
                                       <autocompleteField>false</autocompleteField>
                                       <category/>
                                       <constantable>false</constantable>
                                       <defaultValue/>
                                       <doNotNormalizeTaggedText>false</doNotNormalizeTaggedText>
                                       <doNotUseInAdjudication>false</doNotUseInAdjudication>
                                       <findMajorityForAllAtomicValues>false</findMajorityForAllAtomicValues>
                                       <htmlClasses/>
                                       <lastModified>2018-05-29T09:25:59Z</lastModified>
                                       <letCustomValues>false</letCustomValues>
                                       <manualField>false</manualField>
                                       <multiValue>false</multiValue>
                                       <options>{"ieExtractorType":"ORIGINAL_APPEARANCE_EXTRACTOR"}</options>
                                       <originalDocumentSource>${question.data.original_document_url}</originalDocumentSource>
                                       <percentRequired>false</percentRequired>
                                       <range>false</range>
                                       <required>false</required>
                                       <sequenceNumber>1</sequenceNumber>
                                       <useBlocks>false</useBlocks>
                                       <useEmptyCell>false</useEmptyCell>
                                    </answer>
                                 </answers>
                                 <assignmentDuration>1800000</assignmentDuration>
                                 <assignmentLimit>1</assignmentLimit>
                                 <attrs>{"lnaa":"Run","lnam":"Tasks","lna":"0"}</attrs>
                                 <autoApprovalDelay>432000000</autoApprovalDelay>
                                 <automaticallyProcessed>0</automaticallyProcessed>
                                 <blockSize>1</blockSize>
                                 <constQualifiedWorkers>false</constQualifiedWorkers>
                                 <currency>USD</currency>
                                 <description>Miscellaneous Tasks</description>
                                 <dynamicTaskRenderingDisabled>true</dynamicTaskRenderingDisabled>
                                 <expiredTime>2592000000</expiredTime>
                                 <faqItems/>
                                 <frameHeight>2500</frameHeight>
                                 <geolocationEnabled>false</geolocationEnabled>
                                 <instructionItems/>
                                 <keywords>Miscellaneous Tasks</keywords>
                                 <maxAssignments>1</maxAssignments>
                                 <moderation>false</moderation>
                                 <moderationFlag>false</moderationFlag>
                                 <origination>CREATED_MANUALLY</origination>
                                 <pendingAssignmentsLimit>10</pendingAssignmentsLimit>
                                 <qualificationInstruction/>
                                 <qualificationRequirements/>
                                 <qualificationRequirementsRequiredForPreview>false</qualificationRequirementsRequiredForPreview>
                                 <qualificationTasks>20</qualificationTasks>
                                 <qualificationTraining>false</qualificationTraining>
                                 <questionRuleMaps>
                                    <questionRuleMap>
                                       <businessRule>
                                          <content>

package com.freedomoss.requester;

#list any import classes here.
import com.freedomoss.objective.model.RuleContext;
import com.freedomoss.objective.model.RuleContext.MajorityType;
import com.freedomoss.objective.model.RuleAssigmentContext;
import com.freedomoss.objective.model.RuleQuestionContext;
import com.freedomoss.requester.model.AwsHitQuestion;
import com.freedomoss.requester.model.AwsHitQuestionItem;
import com.freedomoss.requester.model.AwsHitQuestionAnswerItem;

import org.slf4j.Logger;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;
import java.util.Map;
import java.util.Iterator;

#declare any global variables here
global RuleContext source
global Logger log
global Map params


rule "Rule context initialization"
auto-focus true
no-loop
dialect "mvel"
agenda-group "initialization-group"
	when
		$ctx:RuleContext(initialized == false);
	then
	    # set parameters

        $ctx.properties[RuleContext.MAJORITY_TYPE] =  RuleContext.MajorityType.COUNT;
        $ctx.properties[RuleContext.MAJORITY_VALUE] = new Integer(1);

        #$ctx.properties[RuleContext.MAX_ASSIGNMENT_LIMIT] = new Integer(1);
        $ctx.properties[RuleContext.MAJORITY_HIT_THRESHOLD] = new Double(100/100);
        $ctx.properties[RuleContext.ASSIGNMENT_APPROVE_THRESHOLD] = new Double(0.5);

        # insert processed facts into memory
        $ctx.updateWorkingMemory();
        # move to business rules
        kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup("calculation").setFocus();
        $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Worst accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 70 if gold accuracy goes up &lt; 75 percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp; $campaignStatistic.goldAccuracy &lt; (75/100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 70);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Normal accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 80 if gold accuracy goes up &gt;= 75 percents and &lt; 90"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= (75/ 100) &amp;&amp; $campaignStatistic.goldAccuracy &lt; (90 / 100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 80);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Super accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 95 if gold accuracy goes up &gt;= 90 percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= (90 / 100) )
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 95);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "0. Check, if exist majority"
agenda-group "calculation"
dialect "mvel"
salience 100
no-loop
	when
	    $ctx:RuleContext (initialized == true, $gold:gold, $threshold:properties.MAJORITY_HIT_THRESHOLD)
        eval($ctx.majorityWithoutGold().size() &gt;= ($ctx.questions.size() - $gold.size()) *  $threshold)
	then
		insert(new String("MAJORITY_FOUND"));
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "1. Approve question by majority"
agenda-group "calculation"
dialect "mvel"
salience 90
no-loop
	when
		((String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true))
		or
		(not String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true, assignments.size == properties.MAX_ASSIGNMENT_LIMIT)))
		$rqc:RuleQuestionContext()
	then
		$rqc.approveQuestion($ctx.majority());
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rqc);
end

rule "3. Approve assignment (always)"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		$ctx:RuleContext(initialized == true, $threshold:properties.ASSIGNMENT_APPROVE_THRESHOLD)
		$rac:RuleAssigmentContext()
	then
	    insert(new String("ASSIGNMENT_PROCESSED"));
		$ctx.addApproved($rac);
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rac);
end

rule "5. Extend HIT"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		not String(toString == "MAJORITY_FOUND")
		$ctx:RuleContext(initialized == true, assignments.size &lt; properties.MAX_ASSIGNMENT_LIMIT);
	then
		$ctx.setExtendHit(true);
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

</content>
                                          <name>Start with one assignment 1+0 pay all</name>
                                          <paramValues>{"NORMAL_ACCURACY_LEVEL_SCORE":"80","NORMAL_ACCURACY_LEVEL_UPPER_LIMIT":"90","WORST_ACCURACY_LEVEL_SCORE":"70","MAJORITY_HIT_THRESHOLD":"100","SUPER_ACCURACY_LEVEL_LOWER_LIMIT":"90","WORST_ACCURACY_LEVEL_UPPER_LIMIT":"75","SUPER_ACCURACY_LEVEL_SCORE":"95","NORMAL_ACCURACY_LEVEL_LOWER_LIMIT":"75","MAJORITY_VALUE":"1","CHECK_EVERY":"5","MAX_ASSIGNMENT_LIMIT":"1"}</paramValues>
                                          <ruleType>DROOLS</ruleType>
                                          <ruleTypeUI>Adjudication</ruleTypeUI>
                                          <template>
                                             <content>

package com.freedomoss.requester;

#list any import classes here.
import com.freedomoss.objective.model.RuleContext;
import com.freedomoss.objective.model.RuleContext.MajorityType;
import com.freedomoss.objective.model.RuleAssigmentContext;
import com.freedomoss.objective.model.RuleQuestionContext;
import com.freedomoss.requester.model.AwsHitQuestion;
import com.freedomoss.requester.model.AwsHitQuestionItem;
import com.freedomoss.requester.model.AwsHitQuestionAnswerItem;

import org.slf4j.Logger;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;
import java.util.Map;
import java.util.Iterator;

#declare any global variables here
global RuleContext source
global Logger log
global Map params


rule "Rule context initialization"
auto-focus true
no-loop
dialect "mvel"
agenda-group "initialization-group"
	when
		$ctx:RuleContext(initialized == false);
	then
	    # set parameters

        $ctx.properties[RuleContext.MAJORITY_TYPE] =  RuleContext.MajorityType.COUNT;
        $ctx.properties[RuleContext.MAJORITY_VALUE] = new Integer({{MAJORITY_VALUE}});

        #$ctx.properties[RuleContext.MAX_ASSIGNMENT_LIMIT] = new Integer({{MAX_ASSIGNMENT_LIMIT}});
        $ctx.properties[RuleContext.MAJORITY_HIT_THRESHOLD] = new Double({{MAJORITY_HIT_THRESHOLD}}/100);
        $ctx.properties[RuleContext.ASSIGNMENT_APPROVE_THRESHOLD] = new Double(0.5);

        # insert processed facts into memory
        $ctx.updateWorkingMemory();
        # move to business rules
        kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup("calculation").setFocus();
        $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Worst accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{WORST_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &lt; {{WORST_ACCURACY_LEVEL_UPPER_LIMIT}} percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp; $campaignStatistic.goldAccuracy &lt; ({{WORST_ACCURACY_LEVEL_UPPER_LIMIT}}/100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{WORST_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Normal accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{NORMAL_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &gt;= {{NORMAL_ACCURACY_LEVEL_LOWER_LIMIT}} percents and &lt; {{NORMAL_ACCURACY_LEVEL_UPPER_LIMIT}}"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= ({{NORMAL_ACCURACY_LEVEL_LOWER_LIMIT}}/ 100) &amp;&amp; $campaignStatistic.goldAccuracy &lt; ({{NORMAL_ACCURACY_LEVEL_UPPER_LIMIT}} / 100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{NORMAL_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Super accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{SUPER_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &gt;= {{SUPER_ACCURACY_LEVEL_LOWER_LIMIT}} percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= ({{SUPER_ACCURACY_LEVEL_LOWER_LIMIT}} / 100) )
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{SUPER_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "0. Check, if exist majority"
agenda-group "calculation"
dialect "mvel"
salience 100
no-loop
	when
	    $ctx:RuleContext (initialized == true, $gold:gold, $threshold:properties.MAJORITY_HIT_THRESHOLD)
        eval($ctx.majorityWithoutGold().size() &gt;= ($ctx.questions.size() - $gold.size()) *  $threshold)
	then
		insert(new String("MAJORITY_FOUND"));
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "1. Approve question by majority"
agenda-group "calculation"
dialect "mvel"
salience 90
no-loop
	when
		((String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true))
		or
		(not String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true, assignments.size == properties.MAX_ASSIGNMENT_LIMIT)))
		$rqc:RuleQuestionContext()
	then
		$rqc.approveQuestion($ctx.majority());
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rqc);
end

rule "3. Approve assignment (always)"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		$ctx:RuleContext(initialized == true, $threshold:properties.ASSIGNMENT_APPROVE_THRESHOLD)
		$rac:RuleAssigmentContext()
	then
	    insert(new String("ASSIGNMENT_PROCESSED"));
		$ctx.addApproved($rac);
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rac);
end

rule "5. Extend HIT"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		not String(toString == "MAJORITY_FOUND")
		$ctx:RuleContext(initialized == true, assignments.size &lt; properties.MAX_ASSIGNMENT_LIMIT);
	then
		$ctx.setExtendHit(true);
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

</content>
                                             <description>Get qualified workers: pay if ${MAJORITY_VALUE} correct answers, start with 1 assignment, extend to maximum of ${MAX_ASSIGNMENT_LIMIT} assignments. Set qualification scores depending on gold accuracy.</description>
                                             <name>Start with 1 assignment X+0 rule (pay all)</name>
                                             <params>
                                                <param>
                                                   <code>CHECK_EVERY</code>
                                                   <defaultValue>5</defaultValue>
                                                   <description>Check every i-th gold question when evaluating qualification score</description>
                                                   <name>Check every i-th gold question</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>MAX_ASSIGNMENT_LIMIT</code>
                                                   <defaultValue>1</defaultValue>
                                                   <description>Maximum number of assignments</description>
                                                   <name>Max assignments limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>NORMAL_ACCURACY_LEVEL_SCORE</code>
                                                   <defaultValue>80</defaultValue>
                                                   <description>Qualification score will be given to a worker who has demonstrated a normal accuracy</description>
                                                   <name>Normal accuracy level score</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>NORMAL_ACCURACY_LEVEL_LOWER_LIMIT</code>
                                                   <defaultValue>75</defaultValue>
                                                   <description>Normal accuracy level lower limit in percents inclusive</description>
                                                   <name>Normal accuracy level lower limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>WORST_ACCURACY_LEVEL_UPPER_LIMIT</code>
                                                   <defaultValue>75</defaultValue>
                                                   <description>Worst accuracy level upper limit in percents exclusive, lower limit is considered as 0</description>
                                                   <name>Worst accuracy level upper limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>SUPER_ACCURACY_LEVEL_SCORE</code>
                                                   <defaultValue>95</defaultValue>
                                                   <description>Qualification score will be given to a worker who has demonstrated a super accuracy</description>
                                                   <name>Super accuracy level score</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>MAJORITY_HIT_THRESHOLD</code>
                                                   <defaultValue>100</defaultValue>
                                                   <description>Percent (from 0 to 100) of correct answers when  majority is found</description>
                                                   <name>Percent of correct answers</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>NORMAL_ACCURACY_LEVEL_UPPER_LIMIT</code>
                                                   <defaultValue>90</defaultValue>
                                                   <description>Normal accuracy level upper limit in percents exclusive</description>
                                                   <name>Normal accuracy level upper limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>SUPER_ACCURACY_LEVEL_LOWER_LIMIT</code>
                                                   <defaultValue>90</defaultValue>
                                                   <description>Super accuracy level lower limit in percents inclusive, upper limit is considered as 100</description>
                                                   <name>Super accuracy level lower limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>MAJORITY_VALUE</code>
                                                   <defaultValue>1</defaultValue>
                                                   <description>Number of correct answers</description>
                                                   <name>Majority value</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>WORST_ACCURACY_LEVEL_SCORE</code>
                                                   <defaultValue>70</defaultValue>
                                                   <description>Qualification score will be given to a worker who has demonstrated a low accuracy</description>
                                                   <name>Worst accuracy level score</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                             </params>
                                          </template>
                                          <uuid>84e370ab-7f81-11e8-80bc-0ae8ba3240ae</uuid>
                                          <workflowRuleMode>ADVANCED</workflowRuleMode>
                                       </businessRule>
                                    </questionRuleMap>
                                 </questionRuleMaps>
                                 <radiusSelector>ExactLocation</radiusSelector>
                                 <randomizeAnswers>false</randomizeAnswers>
                                 <recursiveThreshold>1</recursiveThreshold>
                                 <restrictedCountries/>
                                 <taskNotificationSchedule>IMMEDIATE</taskNotificationSchedule>
                                 <templates>
                                    <template>
                                       <code/>
                                       <content>&lt;#include "extras.ftl" parse=true/&gt;
&lt;#include "html.ftl" parse=true/&gt;
&lt;#include "answers.ftl" parse=true/&gt;
&lt;#assign FEEDBACK_ENABLED = true&gt;

&lt;@hit contentCss="${applicationResourceUrl}/workfusion-resources/saas/ms/ms.bootstrap.min.css"&gt;
&lt;@script src="${applicationResourceUrl}/workfusion-resources/bootstrap/js/bootstrap-tab.js"/&gt;  
  

  
&lt;@instructions title="&lt;h2&gt;[Standard] Document Tagging Sample&lt;/h2&gt;"&gt;
  &lt;!--- editable content --&gt;
  &lt;@editable id="__INSTRUCTIONS__"&gt;&lt;br&gt;&lt;br&gt;&lt;/@editable&gt;
&lt;/@instructions&gt;
&lt;@form&gt;
&lt;#if questions??&gt;
    &lt;div class="thumbnail"&gt;
    &lt;#list questions as question&gt;
      &lt;@report question=question includeAll=true/&gt;
      &lt;div style="position:relative;margin:2px 0px" class="block question"&gt;
           &lt;div style="position:absolute;top:0px;right:0px;background-color:#e0e0e0;padding:1px 4px;border: 1px solid #C0C0C0;border-radius: 0px" class="number"&gt;
                &lt;b&gt;${question_index + 1}&lt;/b&gt;
           &lt;/div&gt;
           &lt;div&gt;
               &lt;div class="place bg-dark"&gt;
                 &lt;@editable id="__DATA__"&gt;Original: &lt;a href="${question.data.original_document_url} " data-mce-href="${question.data.original_document_url}"&gt;${question.data.original_document_url} &lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;/@editable&gt;
               &lt;/div&gt;
               &lt;div class="place"&gt;
                 &lt;@answers question=question/&gt;
               &lt;/div&gt;
            &lt;/div&gt;
      &lt;/div&gt;
    &lt;/#list&gt;
    &lt;/div&gt;
&lt;/#if&gt;
&lt;@submit text="Submit" /&gt;
&lt;/@form&gt;
&lt;/@hit&gt;</content>
                                       <name>[Standard] Document Tagging Sample</name>
                                       <origination>CREATED_AUTOMATICALLY</origination>
                                       <status>ACTIVE</status>
                                       <type>TASK</type>
                                       <uuid>ff3e51af-cefe-49ca-8c02-fdbd61baa1ff</uuid>
                                       <version>
                                          <componentUuid>cc95da31-c1db-4251-9423-85ec27af2d6b</componentUuid>
                                          <incrementalVersion>1.0</incrementalVersion>
                                          <lastInChain>true</lastInChain>
                                          <lastModified>2018-05-29T09:25:59Z</lastModified>
                                          <versionUuid>beed6d61-b8bb-4873-90a7-5dd5b6de6a6d</versionUuid>
                                       </version>
                                    </template>
                                 </templates>
                                 <title>[Standard] Document Tagging Sample</title>
                                 <useCommonHitCoordinates>true</useCommonHitCoordinates>
                                 <uuid>fd831633-796c-4f5d-93b2-4e6dc5ac4a17</uuid>
                                 <version>
                                    <componentUuid>1761bcef-ce47-49cf-b2d8-1397e344b559</componentUuid>
                                    <incrementalVersion>1.1</incrementalVersion>
                                    <lastInChain>true</lastInChain>
                                    <lastModified>2018-07-11T10:23:40Z</lastModified>
                                    <versionUuid>bb44681a-df1c-4ba3-bcf4-478013d823ba</versionUuid>
                                 </version>
                                 <workSetting>
                                    <category>
                                       <automation>false</automation>
                                       <description/>
                                       <enabled>true</enabled>
                                       <executingType>HUMAN</executingType>
                                       <name>Other</name>
                                       <private>false</private>
                                       <publicId>dd92f240-144b-4fef-8476-4ec0acbc1104</publicId>
                                    </category>
                                    <contentType>BLANK</contentType>
                                    <description/>
                                    <enabled>true</enabled>
                                    <name>Miscellaneous Tasks</name>
                                    <publicId>26e6e095-00bb-43fa-8c34-af0b18e71ac8</publicId>
                                    <version>
                                       <componentUuid>26e6e095-00bb-43fa-8c34-af0b18e71ac8</componentUuid>
                                       <incrementalVersion>1.0</incrementalVersion>
                                       <lastInChain>true</lastInChain>
                                       <lastModified>2018-07-04T11:58:04Z</lastModified>
                                       <versionUuid>26e6e095-00bb-43fa-8c34-af0b18e71ac8</versionUuid>
                                    </version>
                                    <answers/>
                                    <businessRules>
                                       <businessRule>
                                          <content>

package com.freedomoss.requester;

#list any import classes here.
import com.freedomoss.objective.model.RuleContext;
import com.freedomoss.objective.model.RuleContext.MajorityType;
import com.freedomoss.objective.model.RuleAssigmentContext;
import com.freedomoss.objective.model.RuleQuestionContext;
import com.freedomoss.requester.model.AwsHitQuestion;
import com.freedomoss.requester.model.AwsHitQuestionItem;
import com.freedomoss.requester.model.AwsHitQuestionAnswerItem;

import org.slf4j.Logger;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;
import java.util.Map;
import java.util.Iterator;

#declare any global variables here
global RuleContext source
global Logger log
global Map params


rule "Rule context initialization"
auto-focus true
no-loop
dialect "mvel"
agenda-group "initialization-group"
	when
		$ctx:RuleContext(initialized == false);
	then
	    # set parameters

        $ctx.properties[RuleContext.MAJORITY_TYPE] =  RuleContext.MajorityType.COUNT;
        $ctx.properties[RuleContext.MAJORITY_VALUE] = new Integer(1);

        #$ctx.properties[RuleContext.MAX_ASSIGNMENT_LIMIT] = new Integer(1);
        $ctx.properties[RuleContext.MAJORITY_HIT_THRESHOLD] = new Double(100/100);
        $ctx.properties[RuleContext.ASSIGNMENT_APPROVE_THRESHOLD] = new Double(0.5);

        # insert processed facts into memory
        $ctx.updateWorkingMemory();
        # move to business rules
        kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup("calculation").setFocus();
        $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Worst accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 70 if gold accuracy goes up &lt; 75 percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp; $campaignStatistic.goldAccuracy &lt; (75/100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 70);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Normal accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 80 if gold accuracy goes up &gt;= 75 percents and &lt; 90"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= (75/ 100) &amp;&amp; $campaignStatistic.goldAccuracy &lt; (90 / 100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 80);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Super accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 95 if gold accuracy goes up &gt;= 90 percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= (90 / 100) )
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 95);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "0. Check, if exist majority"
agenda-group "calculation"
dialect "mvel"
salience 100
no-loop
	when
	    $ctx:RuleContext (initialized == true, $gold:gold, $threshold:properties.MAJORITY_HIT_THRESHOLD)
        eval($ctx.majorityWithoutGold().size() &gt;= ($ctx.questions.size() - $gold.size()) *  $threshold)
	then
		insert(new String("MAJORITY_FOUND"));
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "1. Approve question by majority"
agenda-group "calculation"
dialect "mvel"
salience 90
no-loop
	when
		((String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true))
		or
		(not String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true, assignments.size == properties.MAX_ASSIGNMENT_LIMIT)))
		$rqc:RuleQuestionContext()
	then
		$rqc.approveQuestion($ctx.majority());
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rqc);
end

rule "3. Approve assignment (always)"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		$ctx:RuleContext(initialized == true, $threshold:properties.ASSIGNMENT_APPROVE_THRESHOLD)
		$rac:RuleAssigmentContext()
	then
	    insert(new String("ASSIGNMENT_PROCESSED"));
		$ctx.addApproved($rac);
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rac);
end

rule "5. Extend HIT"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		not String(toString == "MAJORITY_FOUND")
		$ctx:RuleContext(initialized == true, assignments.size &lt; properties.MAX_ASSIGNMENT_LIMIT);
	then
		$ctx.setExtendHit(true);
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

</content>
                                          <name>Start with one assignment 1+0 pay all</name>
                                          <paramValues>{"NORMAL_ACCURACY_LEVEL_SCORE":"80","NORMAL_ACCURACY_LEVEL_UPPER_LIMIT":"90","WORST_ACCURACY_LEVEL_SCORE":"70","MAJORITY_HIT_THRESHOLD":"100","SUPER_ACCURACY_LEVEL_LOWER_LIMIT":"90","WORST_ACCURACY_LEVEL_UPPER_LIMIT":"75","SUPER_ACCURACY_LEVEL_SCORE":"95","NORMAL_ACCURACY_LEVEL_LOWER_LIMIT":"75","MAJORITY_VALUE":"1","CHECK_EVERY":"5","MAX_ASSIGNMENT_LIMIT":"1"}</paramValues>
                                          <ruleType>DROOLS</ruleType>
                                          <ruleTypeUI>Adjudication</ruleTypeUI>
                                          <template>
                                             <content>

package com.freedomoss.requester;

#list any import classes here.
import com.freedomoss.objective.model.RuleContext;
import com.freedomoss.objective.model.RuleContext.MajorityType;
import com.freedomoss.objective.model.RuleAssigmentContext;
import com.freedomoss.objective.model.RuleQuestionContext;
import com.freedomoss.requester.model.AwsHitQuestion;
import com.freedomoss.requester.model.AwsHitQuestionItem;
import com.freedomoss.requester.model.AwsHitQuestionAnswerItem;

import org.slf4j.Logger;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;
import java.util.Map;
import java.util.Iterator;

#declare any global variables here
global RuleContext source
global Logger log
global Map params


rule "Rule context initialization"
auto-focus true
no-loop
dialect "mvel"
agenda-group "initialization-group"
	when
		$ctx:RuleContext(initialized == false);
	then
	    # set parameters

        $ctx.properties[RuleContext.MAJORITY_TYPE] =  RuleContext.MajorityType.COUNT;
        $ctx.properties[RuleContext.MAJORITY_VALUE] = new Integer({{MAJORITY_VALUE}});

        #$ctx.properties[RuleContext.MAX_ASSIGNMENT_LIMIT] = new Integer({{MAX_ASSIGNMENT_LIMIT}});
        $ctx.properties[RuleContext.MAJORITY_HIT_THRESHOLD] = new Double({{MAJORITY_HIT_THRESHOLD}}/100);
        $ctx.properties[RuleContext.ASSIGNMENT_APPROVE_THRESHOLD] = new Double(0.5);

        # insert processed facts into memory
        $ctx.updateWorkingMemory();
        # move to business rules
        kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup("calculation").setFocus();
        $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Worst accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{WORST_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &lt; {{WORST_ACCURACY_LEVEL_UPPER_LIMIT}} percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp; $campaignStatistic.goldAccuracy &lt; ({{WORST_ACCURACY_LEVEL_UPPER_LIMIT}}/100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{WORST_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Normal accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{NORMAL_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &gt;= {{NORMAL_ACCURACY_LEVEL_LOWER_LIMIT}} percents and &lt; {{NORMAL_ACCURACY_LEVEL_UPPER_LIMIT}}"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= ({{NORMAL_ACCURACY_LEVEL_LOWER_LIMIT}}/ 100) &amp;&amp; $campaignStatistic.goldAccuracy &lt; ({{NORMAL_ACCURACY_LEVEL_UPPER_LIMIT}} / 100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{NORMAL_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Super accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{SUPER_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &gt;= {{SUPER_ACCURACY_LEVEL_LOWER_LIMIT}} percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= ({{SUPER_ACCURACY_LEVEL_LOWER_LIMIT}} / 100) )
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{SUPER_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "0. Check, if exist majority"
agenda-group "calculation"
dialect "mvel"
salience 100
no-loop
	when
	    $ctx:RuleContext (initialized == true, $gold:gold, $threshold:properties.MAJORITY_HIT_THRESHOLD)
        eval($ctx.majorityWithoutGold().size() &gt;= ($ctx.questions.size() - $gold.size()) *  $threshold)
	then
		insert(new String("MAJORITY_FOUND"));
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "1. Approve question by majority"
agenda-group "calculation"
dialect "mvel"
salience 90
no-loop
	when
		((String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true))
		or
		(not String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true, assignments.size == properties.MAX_ASSIGNMENT_LIMIT)))
		$rqc:RuleQuestionContext()
	then
		$rqc.approveQuestion($ctx.majority());
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rqc);
end

rule "3. Approve assignment (always)"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		$ctx:RuleContext(initialized == true, $threshold:properties.ASSIGNMENT_APPROVE_THRESHOLD)
		$rac:RuleAssigmentContext()
	then
	    insert(new String("ASSIGNMENT_PROCESSED"));
		$ctx.addApproved($rac);
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rac);
end

rule "5. Extend HIT"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		not String(toString == "MAJORITY_FOUND")
		$ctx:RuleContext(initialized == true, assignments.size &lt; properties.MAX_ASSIGNMENT_LIMIT);
	then
		$ctx.setExtendHit(true);
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

</content>
                                             <description>Get qualified workers: pay if ${MAJORITY_VALUE} correct answers, start with 1 assignment, extend to maximum of ${MAX_ASSIGNMENT_LIMIT} assignments. Set qualification scores depending on gold accuracy.</description>
                                             <name>Start with 1 assignment X+0 rule (pay all)</name>
                                             <params>
                                                <param>
                                                   <code>CHECK_EVERY</code>
                                                   <defaultValue>5</defaultValue>
                                                   <description>Check every i-th gold question when evaluating qualification score</description>
                                                   <name>Check every i-th gold question</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>MAX_ASSIGNMENT_LIMIT</code>
                                                   <defaultValue>1</defaultValue>
                                                   <description>Maximum number of assignments</description>
                                                   <name>Max assignments limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>NORMAL_ACCURACY_LEVEL_SCORE</code>
                                                   <defaultValue>80</defaultValue>
                                                   <description>Qualification score will be given to a worker who has demonstrated a normal accuracy</description>
                                                   <name>Normal accuracy level score</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>NORMAL_ACCURACY_LEVEL_LOWER_LIMIT</code>
                                                   <defaultValue>75</defaultValue>
                                                   <description>Normal accuracy level lower limit in percents inclusive</description>
                                                   <name>Normal accuracy level lower limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>WORST_ACCURACY_LEVEL_UPPER_LIMIT</code>
                                                   <defaultValue>75</defaultValue>
                                                   <description>Worst accuracy level upper limit in percents exclusive, lower limit is considered as 0</description>
                                                   <name>Worst accuracy level upper limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>SUPER_ACCURACY_LEVEL_SCORE</code>
                                                   <defaultValue>95</defaultValue>
                                                   <description>Qualification score will be given to a worker who has demonstrated a super accuracy</description>
                                                   <name>Super accuracy level score</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>MAJORITY_HIT_THRESHOLD</code>
                                                   <defaultValue>100</defaultValue>
                                                   <description>Percent (from 0 to 100) of correct answers when  majority is found</description>
                                                   <name>Percent of correct answers</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>NORMAL_ACCURACY_LEVEL_UPPER_LIMIT</code>
                                                   <defaultValue>90</defaultValue>
                                                   <description>Normal accuracy level upper limit in percents exclusive</description>
                                                   <name>Normal accuracy level upper limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>SUPER_ACCURACY_LEVEL_LOWER_LIMIT</code>
                                                   <defaultValue>90</defaultValue>
                                                   <description>Super accuracy level lower limit in percents inclusive, upper limit is considered as 100</description>
                                                   <name>Super accuracy level lower limit</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>MAJORITY_VALUE</code>
                                                   <defaultValue>1</defaultValue>
                                                   <description>Number of correct answers</description>
                                                   <name>Majority value</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                                <param>
                                                   <code>WORST_ACCURACY_LEVEL_SCORE</code>
                                                   <defaultValue>70</defaultValue>
                                                   <description>Qualification score will be given to a worker who has demonstrated a low accuracy</description>
                                                   <name>Worst accuracy level score</name>
                                                   <type>INPUT_NUMBER</type>
                                                </param>
                                             </params>
                                          </template>
                                          <uuid>84e370ab-7f81-11e8-80bc-0ae8ba3240ae</uuid>
                                          <workflowRuleMode>ADVANCED</workflowRuleMode>
                                       </businessRule>
                                    </businessRules>
                                    <isPrivate>false</isPrivate>
                                    <items>
                                       <item>
                                          <type>HIT_EXPIRES_IN</type>
                                          <value>2592000000</value>
                                       </item>
                                       <item>
                                          <type>AUTOMATICALLY_APPROVED</type>
                                          <value>432000000</value>
                                       </item>
                                       <item>
                                          <type>RECOMMENDATION_TAGS</type>
                                          <value>["information_extraction"]</value>
                                       </item>
                                       <item>
                                          <type>TIME_PER_ASSIGNMENT</type>
                                          <value>1800000</value>
                                       </item>
                                       <item>
                                          <type>TITLE</type>
                                          <value>Miscellaneous Tasks</value>
                                       </item>
                                    </items>
                                    <template>
                                       <code/>
                                       <content>&lt;#include "extras.ftl" parse=true/&gt;
&lt;#include "html.ftl" parse=true/&gt;
&lt;#include "answers.ftl" parse=true/&gt;
&lt;#assign FEEDBACK_ENABLED = true&gt;

&lt;@hit contentCss="${applicationResourceUrl}/workfusion-resources/saas/ms/ms.bootstrap.min.css"&gt;
&lt;@script src="${applicationResourceUrl}/workfusion-resources/bootstrap/js/bootstrap-tab.js"/&gt;  
  

  
&lt;@instructions title="&lt;h2&gt;BLANK&lt;/h2&gt;"&gt;
  &lt;!--- editable content --&gt;
  &lt;@editable id="__INSTRUCTIONS__"&gt;&lt;br&gt;&lt;br&gt;&lt;/@editable&gt;
&lt;/@instructions&gt;
&lt;@form&gt;
&lt;#if questions??&gt;
    &lt;div class="thumbnail"&gt;
    &lt;#list questions as question&gt;
      &lt;@report question=question includeAll=true/&gt;
      &lt;div style="position:relative;margin:2px 0px" class="block question"&gt;
           &lt;div style="position:absolute;top:0px;right:0px;background-color:#e0e0e0;padding:1px 4px;border: 1px solid #C0C0C0;border-radius: 0px" class="number"&gt;
                &lt;b&gt;${question_index + 1}&lt;/b&gt;
           &lt;/div&gt;
           &lt;div&gt;
               &lt;div class="place bg-dark"&gt;
                 &lt;@editable id="__DATA__"&gt;${question.data.blank} &lt;br&gt;&lt;br&gt;&lt;/@editable&gt;
               &lt;/div&gt;
               &lt;div class="place"&gt;
                 &lt;@answers question=question/&gt;
               &lt;/div&gt;
            &lt;/div&gt;
      &lt;/div&gt;
    &lt;/#list&gt;
    &lt;/div&gt;
&lt;/#if&gt;
&lt;@submit text="Submit" /&gt;
&lt;/@form&gt;
&lt;/@hit&gt;</content>
                                       <name>Blank</name>
                                       <origination>CREATED_MANUALLY</origination>
                                       <status>ACTIVE</status>
                                       <type>BASE</type>
                                       <uuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc3</uuid>
                                       <version>
                                          <componentUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc3</componentUuid>
                                          <incrementalVersion>1.0</incrementalVersion>
                                          <lastInChain>true</lastInChain>
                                          <lastModified>2012-12-27T00:00:00Z</lastModified>
                                          <versionUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc3</versionUuid>
                                       </version>
                                    </template>
                                 </workSetting>
                              </question>
                              <requiresData>true</requiresData>
                              <status>ACTIVE</status>
                              <streamComplexRunThreshold>1</streamComplexRunThreshold>
                              <streamTimeInterval>Immediately</streamTimeInterval>
                              <streamTimeIntervalValue>0</streamTimeIntervalValue>
                              <streamValueType>Tasks</streamValueType>
                              <title>[Standard] Document Tagging Sample</title>
                              <type>SINGLE</type>
                              <uuid>65b7c930-2bc8-4959-b05c-88a54dceec03</uuid>
                              <validWorkflow>false</validWorkflow>
                              <version>
                                 <componentUuid>9105ba8a-c6d2-48d6-bdb9-ba3db908bb23</componentUuid>
                                 <incrementalVersion>1.2</incrementalVersion>
                                 <lastInChain>true</lastInChain>
                                 <lastModified>2018-07-11T10:23:40Z</lastModified>
                                 <versionUuid>afe596d6-9771-4ea2-bac6-03699a4572c1</versionUuid>
                              </version>
                              <workSettingBase>false</workSettingBase>
                           </campaign>
                           <deleted>false</deleted>
                           <stepIndex>4</stepIndex>
                           <stepPosition>INTERMEDIATE</stepPosition>
                           <uuid>0f60d6f0-e9ad-4e5e-b839-8e7efa37c4a6</uuid>
                        </campaignMap>
                        <campaignMap>
                           <blockSize>1</blockSize>
                           <businessRule>
                              <content>#RuleContext.APPROVE_ALL_RULE</content>
                              <name>Approve All</name>
                              <ruleType>WORKFLOW_RULE</ruleType>
                              <ruleTypeUI>Composite</ruleTypeUI>
                              <uuid>301d583f-9b81-45c6-8181-06a7731619ca</uuid>
                              <workflowRuleMode>SIMPLE</workflowRuleMode>
                           </businessRule>
                           <campaign>
                              <active>false</active>
                              <businessRules/>
                              <campaignMaps/>
                              <campaigns/>
                              <executingType>MACHINE</executingType>
                              <goldBucketBlockSize>0</goldBucketBlockSize>
                              <goldRatio>0</goldRatio>
                              <goldSource>Empty</goldSource>
                              <goldType>Percentage</goldType>
                              <machineConfig>
                                 <answers/>
                                 <content>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config xmlns="http://web-harvest.sourceforge.net/schema/1.0/config"
	scriptlang="groovy"&gt;
  	
  	&lt;script&gt;&lt;![CDATA[
		import groovy.json.JsonSlurper;

		result = new JsonSlurper().parseText(ocr_json.toString());

		if(result.xml != null) {
			ocr_document_url = result.xml.ocr_raw_processed_document_url;
		} else if(result.xmlForCorrectedImage != null) {
			ocr_document_url = result.xmlForCorrectedImage.ocr_raw_processed_document_url;
		} else if(result.html != null) {
			ocr_document_url = result.html.ocr_document_url;
		} else if(result.txt != null) {
			ocr_document_url = result.txt.ocr_document_url;
		} else {
			ocr_document_url = result.pdfSearchable.ocr_document_url;
		}	
	]]&gt;&lt;/script&gt;
  
	&lt;export include-original-data="true"&gt;
    	&lt;single-column name="ocr_document_url" value="${ocr_document_url}" /&gt;
	&lt;/export&gt;
&lt;/config&gt;</content>
                                 <description/>
                                 <includedConfigs/>
                                 <inclusionCode>701e09d6-90f9-425c-a229-b93f529b92f2</inclusionCode>
                                 <jsonParams>{"configXMLModified":"true"}</jsonParams>
                                 <machineWorkSetting>
                                    <category>
                                       <automation>false</automation>
                                       <description/>
                                       <enabled>true</enabled>
                                       <executingType>MACHINE</executingType>
                                       <name>Other</name>
                                       <private>false</private>
                                       <publicId>dd92f240-144b-4fef-8476-4ec0acbc1105</publicId>
                                    </category>
                                    <contentType>BLANK</contentType>
                                    <description/>
                                    <enabled>true</enabled>
                                    <name>Miscellaneous Tasks</name>
                                    <publicId>26e6e095-00bb-43fa-8c34-af0b18e71ac9</publicId>
                                    <version>
                                       <componentUuid>26e6e095-00bb-43fa-8c34-af0b18e71ac9</componentUuid>
                                       <incrementalVersion>1.0</incrementalVersion>
                                       <lastInChain>true</lastInChain>
                                       <lastModified>2018-07-04T11:58:10Z</lastModified>
                                       <versionUuid>26e6e095-00bb-43fa-8c34-af0b18e71ac9</versionUuid>
                                    </version>
                                    <answers/>
                                    <machineWorkSettingType>BASIC</machineWorkSettingType>
                                    <template>
                                       <content>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config charset="UTF-8"&gt;
	&lt;export include-original-data="true"&gt;
	&lt;/export&gt;
&lt;/config&gt;</content>
                                       <name>Blank</name>
                                       <origination>CREATED_MANUALLY</origination>
                                       <status>ACTIVE</status>
                                       <type>BASE_MACHINE</type>
                                       <uuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</uuid>
                                       <version>
                                          <componentUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</componentUuid>
                                          <incrementalVersion>1.0</incrementalVersion>
                                          <lastInChain>true</lastInChain>
                                          <lastModified>2012-12-27T00:00:00Z</lastModified>
                                          <versionUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</versionUuid>
                                       </version>
                                    </template>
                                 </machineWorkSetting>
                                 <machineWorkSettingType>BASIC</machineWorkSettingType>
                                 <name>[Standard] Prepare URL</name>
                                 <machineConfigOptions/>
                                 <sourceType>MANUAL</sourceType>
                                 <template>
                                    <content>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config charset="UTF-8"&gt;
	&lt;export include-original-data="true"&gt;
	&lt;/export&gt;
&lt;/config&gt;</content>
                                    <name>Blank</name>
                                    <origination>CREATED_MANUALLY</origination>
                                    <status>ACTIVE</status>
                                    <type>BASE_MACHINE</type>
                                    <uuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</uuid>
                                    <version>
                                       <componentUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</componentUuid>
                                       <incrementalVersion>1.0</incrementalVersion>
                                       <lastInChain>true</lastInChain>
                                       <lastModified>2012-12-27T00:00:00Z</lastModified>
                                       <versionUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</versionUuid>
                                    </version>
                                 </template>
                                 <uuid>701e09d6-90f9-425c-a229-b93f529b92f2</uuid>
                                 <version>
                                    <componentUuid>1d58607e-74a7-4359-937e-139d054b9d18</componentUuid>
                                    <incrementalVersion>1.1</incrementalVersion>
                                    <lastInChain>true</lastInChain>
                                    <lastModified>2018-07-11T10:23:40Z</lastModified>
                                    <versionUuid>ffa9f9f1-086d-40c9-95aa-79e296913426</versionUuid>
                                 </version>
                                 <code/>
                              </machineConfig>
                              <moderation>false</moderation>
                              <origination>CREATED_AUTOMATICALLY</origination>
                              <requiresData>true</requiresData>
                              <status>ACTIVE</status>
                              <streamComplexRunThreshold>1</streamComplexRunThreshold>
                              <streamTimeInterval>Immediately</streamTimeInterval>
                              <streamTimeIntervalValue>0</streamTimeIntervalValue>
                              <streamValueType>Tasks</streamValueType>
                              <title>[Standard] Prepare URL</title>
                              <type>SINGLE</type>
                              <uuid>b62637a3-4321-4b59-b23c-4c4405a34433</uuid>
                              <validWorkflow>false</validWorkflow>
                              <version>
                                 <componentUuid>f63f050d-1cc8-48e8-b80e-046a76186ba8</componentUuid>
                                 <incrementalVersion>1.1</incrementalVersion>
                                 <lastInChain>true</lastInChain>
                                 <lastModified>2018-07-11T10:33:49Z</lastModified>
                                 <versionUuid>e8598c50-90bd-4c09-8640-11bad58641cc</versionUuid>
                              </version>
                              <workSettingBase>false</workSettingBase>
                           </campaign>
                           <deleted>false</deleted>
                           <stepIndex>5</stepIndex>
                           <stepPosition>INTERMEDIATE</stepPosition>
                           <uuid>1cfd9ef6-31ba-4611-a9fd-3762e191871e</uuid>
                        </campaignMap>
                        <campaignMap>
                           <blockSize>1</blockSize>
                           <businessRule>
                              <content>#RuleContext.APPROVE_ALL_RULE</content>
                              <name>Approve All</name>
                              <ruleType>WORKFLOW_RULE</ruleType>
                              <ruleTypeUI>Composite</ruleTypeUI>
                              <uuid>720d9b4e-6e39-41e1-91ab-31d46b94f0a5</uuid>
                              <workflowRuleMode>SIMPLE</workflowRuleMode>
                           </businessRule>
                           <campaign>
                              <active>false</active>
                              <businessRules/>
                              <campaignMaps/>
                              <campaigns/>
                              <executingType>MACHINE</executingType>
                              <goldBucketBlockSize>0</goldBucketBlockSize>
                              <goldRatio>0</goldRatio>
                              <goldSource>Empty</goldSource>
                              <goldType>Percentage</goldType>
                              <machineConfig>
                                 <answers/>
                                 <content>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config xmlns="http://web-harvest.sourceforge.net/schema/1.0/config"
	scriptlang="groovy"&gt;
  	
  	&lt;script&gt;&lt;![CDATA[
		import groovy.json.JsonSlurper;

		result = new JsonSlurper().parseText(ocr_json.toString());
		ocr_document_url = result.xmlForCorrectedImage.ocr_tood_document_url;
	]]&gt;&lt;/script&gt;
  
	&lt;export include-original-data="true"&gt;
    	&lt;single-column name="ocr_document_url" value="${ocr_document_url}" /&gt;
	&lt;/export&gt;
&lt;/config&gt;</content>
                                 <description/>
                                 <includedConfigs/>
                                 <inclusionCode>81026fcd-0d49-4dfd-a95f-83dd05088a1e</inclusionCode>
                                 <jsonParams>{"configXMLModified":"true"}</jsonParams>
                                 <machineWorkSetting>
                                    <category>
                                       <automation>false</automation>
                                       <description/>
                                       <enabled>true</enabled>
                                       <executingType>MACHINE</executingType>
                                       <name>Other</name>
                                       <private>false</private>
                                       <publicId>dd92f240-144b-4fef-8476-4ec0acbc1105</publicId>
                                    </category>
                                    <contentType>BLANK</contentType>
                                    <description/>
                                    <enabled>true</enabled>
                                    <name>Miscellaneous Tasks</name>
                                    <publicId>26e6e095-00bb-43fa-8c34-af0b18e71ac9</publicId>
                                    <version>
                                       <componentUuid>26e6e095-00bb-43fa-8c34-af0b18e71ac9</componentUuid>
                                       <incrementalVersion>1.0</incrementalVersion>
                                       <lastInChain>true</lastInChain>
                                       <lastModified>2018-07-04T11:58:10Z</lastModified>
                                       <versionUuid>26e6e095-00bb-43fa-8c34-af0b18e71ac9</versionUuid>
                                    </version>
                                    <answers/>
                                    <machineWorkSettingType>BASIC</machineWorkSettingType>
                                    <template>
                                       <content>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config charset="UTF-8"&gt;
	&lt;export include-original-data="true"&gt;
	&lt;/export&gt;
&lt;/config&gt;</content>
                                       <name>Blank</name>
                                       <origination>CREATED_MANUALLY</origination>
                                       <status>ACTIVE</status>
                                       <type>BASE_MACHINE</type>
                                       <uuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</uuid>
                                       <version>
                                          <componentUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</componentUuid>
                                          <incrementalVersion>1.0</incrementalVersion>
                                          <lastInChain>true</lastInChain>
                                          <lastModified>2012-12-27T00:00:00Z</lastModified>
                                          <versionUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</versionUuid>
                                       </version>
                                    </template>
                                 </machineWorkSetting>
                                 <machineWorkSettingType>BASIC</machineWorkSettingType>
                                 <name>[TOOD] Prepare URL</name>
                                 <machineConfigOptions/>
                                 <sourceType>MANUAL</sourceType>
                                 <template>
                                    <content>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config charset="UTF-8"&gt;
	&lt;export include-original-data="true"&gt;
	&lt;/export&gt;
&lt;/config&gt;</content>
                                    <name>Blank</name>
                                    <origination>CREATED_MANUALLY</origination>
                                    <status>ACTIVE</status>
                                    <type>BASE_MACHINE</type>
                                    <uuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</uuid>
                                    <version>
                                       <componentUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</componentUuid>
                                       <incrementalVersion>1.0</incrementalVersion>
                                       <lastInChain>true</lastInChain>
                                       <lastModified>2012-12-27T00:00:00Z</lastModified>
                                       <versionUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</versionUuid>
                                    </version>
                                 </template>
                                 <uuid>81026fcd-0d49-4dfd-a95f-83dd05088a1e</uuid>
                                 <version>
                                    <componentUuid>cd6fe770-99bf-4ce5-a76d-fd6e9c542014</componentUuid>
                                    <incrementalVersion>1.1</incrementalVersion>
                                    <lastInChain>true</lastInChain>
                                    <lastModified>2018-07-11T10:23:40Z</lastModified>
                                    <versionUuid>b23fa428-0c8b-4cba-84f1-c081516e97d4</versionUuid>
                                 </version>
                                 <code/>
                              </machineConfig>
                              <moderation>false</moderation>
                              <origination>CREATED_AUTOMATICALLY</origination>
                              <requiresData>true</requiresData>
                              <status>ACTIVE</status>
                              <streamComplexRunThreshold>1</streamComplexRunThreshold>
                              <streamTimeInterval>Immediately</streamTimeInterval>
                              <streamTimeIntervalValue>0</streamTimeIntervalValue>
                              <streamValueType>Tasks</streamValueType>
                              <title>[TOOD] Prepare URL</title>
                              <type>SINGLE</type>
                              <uuid>7867f29c-b76b-4372-ab8f-36084037ceae</uuid>
                              <validWorkflow>false</validWorkflow>
                              <version>
                                 <componentUuid>38841804-66b6-4442-970a-25834764dd4b</componentUuid>
                                 <incrementalVersion>1.1</incrementalVersion>
                                 <lastInChain>true</lastInChain>
                                 <lastModified>2018-07-11T10:33:49Z</lastModified>
                                 <versionUuid>f286b3e6-3b86-4a26-8d73-63a3dd624a4c</versionUuid>
                              </version>
                              <workSettingBase>false</workSettingBase>
                           </campaign>
                           <deleted>false</deleted>
                           <stepIndex>6</stepIndex>
                           <stepPosition>INTERMEDIATE</stepPosition>
                           <uuid>2a3cdd42-4797-4c28-b9ff-bc545c152b10</uuid>
                        </campaignMap>
                        <campaignMap>
                           <businessRule>
                              <content>package com.freedomoss.requester;

#list any import classes here.
import com.freedomoss.objective.model.CompositeRuleContext;
import com.freedomoss.objective.model.CompositeRuleDataItemContext;
import com.freedomoss.requester.model.AwsHitQuestionItem;
import com.freedomoss.requester.model.AwsHitQuestionAnswerItem;
import org.slf4j.Logger;
import java.util.Map;
import java.util.Iterator;
import java.util.List;
import java.util.Set;
import java.util.ArrayList;
import com.freedomoss.requester.dto.SubmissionResultDTO;

#declare any global variables here
global CompositeRuleContext source
global Logger log
global Map params



rule "Rule context initialization"
auto-focus true
no-loop
dialect "mvel"
agenda-group "initialization-group"
	when
		$ctx:CompositeRuleContext(initialized == false);
	then
		$ctx.updateWorkingMemory();
		# move to business rules
		$ctx.logExecutedRule(kcontext.getRule().getName());
		kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup("calculation").setFocus();
end</content>
                              <name>Business Process: End Rule</name>
                              <ruleType>WORKFLOW_RULE</ruleType>
                              <uuid>b0cc04b4-0456-4dcc-8d62-0b29be4a7429</uuid>
                              <workflowRuleMode>ADVANCED</workflowRuleMode>
                           </businessRule>
                           <campaign>
                              <active>false</active>
                              <businessRules/>
                              <campaignMaps/>
                              <campaigns/>
                              <executingType>MACHINE</executingType>
                              <goldBucketBlockSize>0</goldBucketBlockSize>
                              <goldRatio>0</goldRatio>
                              <goldSource>Empty</goldSource>
                              <goldType>Percentage</goldType>
                              <machineConfig>
                                 <answers/>
                                 <content>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config charset="UTF-8"&gt;

    &lt;var-def name="exportType"&gt;
        &lt;case&gt;
            &lt;if condition='${sys.isVariableDefined("_sys_export_type")}'&gt;
                &lt;template&gt;${_sys_export_type}&lt;/template&gt;
            &lt;/if&gt;
        &lt;/case&gt;
    &lt;/var-def&gt;

    &lt;var-def name="exportColumns"&gt;
        &lt;case&gt;
            &lt;if condition='${sys.isVariableDefined("_sys_export_columns")}'&gt;
                &lt;template&gt;${_sys_export_columns}&lt;/template&gt;
            &lt;/if&gt;
            &lt;else&gt;&lt;/else&gt;
        &lt;/case&gt;
    &lt;/var-def&gt;

    &lt;var-def name="columnNameCase"&gt;
        &lt;case&gt;
            &lt;if condition='${sys.isVariableDefined("_sys_column_name_case")}'&gt;
                &lt;template&gt;${_sys_column_name_case}&lt;/template&gt;
            &lt;/if&gt;
            &lt;else&gt;keep&lt;/else&gt;
        &lt;/case&gt;
    &lt;/var-def&gt;

    &lt;var-def name="dataOnly"&gt;
        &lt;case&gt;
            &lt;if condition='${sys.isVariableDefined("_sys_data_only")}'&gt;
                &lt;template&gt;${_sys_data_only}&lt;/template&gt;
            &lt;/if&gt;
            &lt;else&gt;true&lt;/else&gt;
        &lt;/case&gt;
    &lt;/var-def&gt;

    &lt;var-def name="datastoreName"&gt;
        &lt;script return="item.getWrappedObject().getRun().getDatastoreName()" /&gt;
    &lt;/var-def&gt;
    &lt;case&gt;
        &lt;if condition="${!datastoreName.isEmpty()}"&gt;
            &lt;insert-datastore   datastore-name="${datastoreName}" create="true"&gt;
                &lt;script return="hit_submission_data_item.getWrappedObject().getItemValueMap()"/&gt;
            &lt;/insert-datastore&gt;
        &lt;/if&gt;
    &lt;/case&gt;

    &lt;export include-original-data="true"
            export-type="${exportType}"
            export-columns="${exportColumns}"
            column-name-case="${columnNameCase}"
            data-only="${dataOnly}"&gt;
    &lt;/export&gt;
&lt;/config&gt;</content>
                                 <description>Default machine campaign for end step.</description>
                                 <includedConfigs/>
                                 <inclusionCode>9e5000e3-c243-42d3-b5ad-c6ac90dec35e</inclusionCode>
                                 <machineWorkSetting>
                                    <category>
                                       <automation>false</automation>
                                       <description/>
                                       <enabled>true</enabled>
                                       <executingType>MACHINE</executingType>
                                       <name>Other</name>
                                       <private>false</private>
                                       <publicId>dd92f240-144b-4fef-8476-4ec0acbc1105</publicId>
                                    </category>
                                    <contentType>BLANK</contentType>
                                    <description/>
                                    <enabled>true</enabled>
                                    <name>Miscellaneous Tasks</name>
                                    <publicId>26e6e095-00bb-43fa-8c34-af0b18e71ac9</publicId>
                                    <version>
                                       <componentUuid>26e6e095-00bb-43fa-8c34-af0b18e71ac9</componentUuid>
                                       <incrementalVersion>1.0</incrementalVersion>
                                       <lastInChain>true</lastInChain>
                                       <lastModified>2018-07-04T11:58:10Z</lastModified>
                                       <versionUuid>26e6e095-00bb-43fa-8c34-af0b18e71ac9</versionUuid>
                                    </version>
                                    <answers/>
                                    <machineWorkSettingType>BASIC</machineWorkSettingType>
                                    <template>
                                       <content>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config charset="UTF-8"&gt;
	&lt;export include-original-data="true"&gt;
	&lt;/export&gt;
&lt;/config&gt;</content>
                                       <name>Blank</name>
                                       <origination>CREATED_MANUALLY</origination>
                                       <status>ACTIVE</status>
                                       <type>BASE_MACHINE</type>
                                       <uuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</uuid>
                                       <version>
                                          <componentUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</componentUuid>
                                          <incrementalVersion>1.0</incrementalVersion>
                                          <lastInChain>true</lastInChain>
                                          <lastModified>2012-12-27T00:00:00Z</lastModified>
                                          <versionUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</versionUuid>
                                       </version>
                                    </template>
                                 </machineWorkSetting>
                                 <name>Final Results</name>
                                 <machineConfigOptions/>
                                 <sourceType>MANUAL</sourceType>
                                 <template>
                                    <content>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config charset="UTF-8"&gt;
	&lt;export include-original-data="true"&gt;
	&lt;/export&gt;
&lt;/config&gt;</content>
                                    <name>Blank</name>
                                    <origination>CREATED_MANUALLY</origination>
                                    <status>ACTIVE</status>
                                    <type>BASE_MACHINE</type>
                                    <uuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</uuid>
                                    <version>
                                       <componentUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</componentUuid>
                                       <incrementalVersion>1.0</incrementalVersion>
                                       <lastInChain>true</lastInChain>
                                       <lastModified>2012-12-27T00:00:00Z</lastModified>
                                       <versionUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc4</versionUuid>
                                    </version>
                                 </template>
                                 <uuid>9e5000e3-c243-42d3-b5ad-c6ac90dec35e</uuid>
                                 <version>
                                    <componentUuid>9e5000e3-c243-42d3-b5ad-c6ac90dec35e</componentUuid>
                                    <incrementalVersion>1.0</incrementalVersion>
                                    <lastInChain>true</lastInChain>
                                    <lastModified>2018-07-04T11:58:19Z</lastModified>
                                    <versionUuid>91a70674-7f81-11e8-80bc-0ae8ba3240ae</versionUuid>
                                 </version>
                                 <code/>
                              </machineConfig>
                              <moderation>false</moderation>
                              <origination>CREATED_AUTOMATICALLY</origination>
                              <requiresData>true</requiresData>
                              <status>ACTIVE</status>
                              <streamComplexRunThreshold>100</streamComplexRunThreshold>
                              <streamTimeInterval>Immediately</streamTimeInterval>
                              <streamTimeIntervalValue>0</streamTimeIntervalValue>
                              <streamValueType>Percents</streamValueType>
                              <title>Final Results</title>
                              <type>SINGLE</type>
                              <uuid>af4c8905-26dd-4120-b208-39ad3530ffc6</uuid>
                              <validWorkflow>false</validWorkflow>
                              <version>
                                 <componentUuid>912e47e0-7f81-11e8-80bc-0ae8ba3240ae</componentUuid>
                                 <incrementalVersion>1.0</incrementalVersion>
                                 <lastInChain>true</lastInChain>
                                 <lastModified>2018-07-04T11:58:19Z</lastModified>
                                 <versionUuid>91a7209d-7f81-11e8-80bc-0ae8ba3240ae</versionUuid>
                              </version>
                              <workSettingBase>false</workSettingBase>
                           </campaign>
                           <deleted>false</deleted>
                           <stepIndex>7</stepIndex>
                           <stepPosition>END</stepPosition>
                           <uuid>16c23b72-1041-495a-a1e7-dd244c45a88b</uuid>
                        </campaignMap>
                     </campaignMaps>
                     <campaigns/>
                     <compositeCampaignVersion>NEW_WORKFLOW</compositeCampaignVersion>
                     <compositeStructureXml>&lt;mxGraphModel&gt;&lt;root&gt;&lt;mxCell id="0"/&gt;&lt;mxCell id="1" parent="0"/&gt;&lt;Start id="2" name="Start" type="start"&gt;&lt;mxCell parent="1" style="start" vertex="1"&gt;&lt;mxGeometry as="geometry" height="32.0" width="32.0" x="60.0" y="66.0"/&gt;&lt;/mxCell&gt;&lt;/Start&gt;&lt;Link id="25" name="" type="link"&gt;&lt;mxCell edge="1" parent="1" source="2" style="link" target="418"&gt;&lt;mxGeometry as="geometry" relative="1" x="0.5" y="10.0"&gt;&lt;mxPoint as="targetPoint" x="140.0" y="82.0"/&gt;&lt;Array as="points"/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;/Link&gt;&lt;End campaignMapUUID="16c23b72-1041-495a-a1e7-dd244c45a88b" id="143" name="End" type="end"&gt;&lt;mxCell parent="1" style="end" vertex="1"&gt;&lt;mxGeometry as="geometry" height="32.0" width="32.0" x="434.0" y="430.0"/&gt;&lt;/mxCell&gt;&lt;/End&gt;&lt;Rule id="323" name="OCR Type" ruleUUID="1a170e7a-0117-4acd-9e9b-fa90f212a56f" type="rule"&gt;&lt;mxCell parent="1" style="rule" vertex="1"&gt;&lt;mxGeometry as="geometry" height="32.0" width="32.0" x="434.0" y="190.0"/&gt;&lt;/mxCell&gt;&lt;/Rule&gt;&lt;Link id="324" name="" type="link"&gt;&lt;mxCell edge="1" parent="1" source="417" style="link" target="323"&gt;&lt;mxGeometry as="geometry" relative="1" x="0.5" y="10.0"&gt;&lt;mxPoint as="sourcePoint" x="450.0" y="122.0"/&gt;&lt;Array as="points"/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;/Link&gt;&lt;Link conditional="true" id="325" label="TOOD" name="" outcomeId="TOOD" ruleUUID="1a170e7a-0117-4acd-9e9b-fa90f212a56f" type="link"&gt;&lt;mxCell edge="1" parent="1" source="323" style="link" target="331"&gt;&lt;mxGeometry as="geometry"&gt;&lt;mxPoint as="targetPoint" x="554.0" y="191.0"/&gt;&lt;Array as="points"/&gt;&lt;mxPoint as="offset" x="13.0" y="-28.0"/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;/Link&gt;&lt;HumanTask automatedCampaignUUID="" automatedUseCaseId="" campaignMapUUID="bd66d3f5-8bad-4abe-aae9-fc58feb18bb7" id="327" name="[TOOD][MT][BASE] Tagging Over Original Document" taskUUID="c7dad6e9-dadb-4a47-b46f-ef5c73c9b31d" type="human_task"&gt;&lt;mxCell parent="1" style="human_task" vertex="1"&gt;&lt;mxGeometry as="geometry" height="60.0" width="160.0" x="220.11666870117188" y="339.53334045410156"/&gt;&lt;/mxCell&gt;&lt;/HumanTask&gt;&lt;HumanTask automatedCampaignUUID="" automatedUseCaseId="" campaignMapUUID="0f60d6f0-e9ad-4e5e-b839-8e7efa37c4a6" id="328" name="[Standard] Document Tagging Sample" taskUUID="65b7c930-2bc8-4959-b05c-88a54dceec03" type="human_task"&gt;&lt;mxCell parent="1" style="human_task" vertex="1"&gt;&lt;mxGeometry as="geometry" height="60.0" width="160.0" x="510.1166687011719" y="339.53334045410156"/&gt;&lt;/mxCell&gt;&lt;/HumanTask&gt;&lt;Link id="329" name="" outcome="ApproveAll" outcomeId="ApproveAll" ruleUUID="635b551d-e2e4-475e-8bd2-46bf42bfb702" type="link"&gt;&lt;mxCell edge="1" parent="1" source="327" style="link" target="143"&gt;&lt;mxGeometry as="geometry" relative="1" x="0.5" y="10.0"&gt;&lt;Array as="points"&gt;&lt;mxPoint x="300.0" y="450.0"/&gt;&lt;/Array&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;/Link&gt;&lt;Link id="330" name="" outcome="ApproveAll" outcomeId="ApproveAll" ruleUUID="425bbd48-1668-4688-a96e-438caa9e4a17" type="link"&gt;&lt;mxCell edge="1" parent="1" source="328" style="link" target="143"&gt;&lt;mxGeometry as="geometry" relative="1" x="0.5" y="10.0"&gt;&lt;Array as="points"&gt;&lt;mxPoint x="590.0" y="450.0"/&gt;&lt;/Array&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;/Link&gt;&lt;MachineTask campaignMapUUID="2a3cdd42-4797-4c28-b9ff-bc545c152b10" id="331" name="[TOOD] Prepare URL" taskUUID="7867f29c-b76b-4372-ab8f-36084037ceae" type="machine_task"&gt;&lt;mxCell parent="1" style="machine_task" vertex="1"&gt;&lt;mxGeometry as="geometry" height="60.0" width="160.0" x="220.0" y="250.0"/&gt;&lt;/mxCell&gt;&lt;/MachineTask&gt;&lt;MachineTask campaignMapUUID="1cfd9ef6-31ba-4611-a9fd-3762e191871e" id="332" name="[Standard] Prepare URL" taskUUID="b62637a3-4321-4b59-b23c-4c4405a34433" type="machine_task"&gt;&lt;mxCell parent="1" style="machine_task" vertex="1"&gt;&lt;mxGeometry as="geometry" height="60.0" width="160.0" x="510.0" y="250.0"/&gt;&lt;/mxCell&gt;&lt;/MachineTask&gt;&lt;Link conditional="true" id="334" label="Standard" name="" outcomeId="Standard" ruleUUID="1a170e7a-0117-4acd-9e9b-fa90f212a56f" type="link"&gt;&lt;mxCell edge="1" parent="1" source="323" style="link" target="332"&gt;&lt;mxGeometry as="geometry"&gt;&lt;mxPoint as="targetPoint" x="554.0" y="191.0"/&gt;&lt;Array as="points"/&gt;&lt;mxPoint as="offset" x="-8.0" y="-28.0"/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;/Link&gt;&lt;Link id="335" name="" outcome="ApproveAll" outcomeId="ApproveAll" ruleUUID="720d9b4e-6e39-41e1-91ab-31d46b94f0a5" type="link"&gt;&lt;mxCell edge="1" parent="1" source="331" style="link" target="327"&gt;&lt;mxGeometry as="geometry" relative="1" x="0.5" y="10.0"/&gt;&lt;/mxCell&gt;&lt;/Link&gt;&lt;Link id="336" name="" outcome="ApproveAll" outcomeId="ApproveAll" ruleUUID="301d583f-9b81-45c6-8181-06a7731619ca" type="link"&gt;&lt;mxCell edge="1" parent="1" source="332" style="link" target="328"&gt;&lt;mxGeometry as="geometry" relative="1" x="0.5" y="10.0"/&gt;&lt;/mxCell&gt;&lt;/Link&gt;&lt;Link id="338" name="" outcome="ApproveAll" outcomeId="ApproveAll" ruleUUID="7aef9f86-db70-4434-83e4-4478ab14a8ed" type="link"&gt;&lt;mxCell edge="1" parent="1" source="418" style="link" target="417"&gt;&lt;mxGeometry as="geometry" relative="1" x="0.5" y="10.0"&gt;&lt;mxPoint as="sourcePoint" x="300.0" y="82.0"/&gt;&lt;mxPoint as="targetPoint" x="360.0" y="82.0"/&gt;&lt;Array as="points"/&gt;&lt;/mxGeometry&gt;&lt;/mxCell&gt;&lt;/Link&gt;&lt;MachineTask campaignMapUUID="796b9a93-5a5f-4b51-b998-724c800f4e08" id="417" name="replace with OCR sub-bp" taskUUID="9f06b1db-c727-4efc-b9d4-e6b7623acfdf" type="machine_task"&gt;&lt;mxCell parent="1" style="machine_task" vertex="1"&gt;&lt;mxGeometry as="geometry" height="60.0" width="160.0" x="400.0" y="52.0"/&gt;&lt;/mxCell&gt;&lt;/MachineTask&gt;&lt;MachineTask campaignMapUUID="29ed8022-f285-4b93-b74a-09b2bb67cfdf" id="418" name="replace with Settings " taskUUID="9a29a1c8-831d-417e-a6dd-a1ee59069aae" type="machine_task"&gt;&lt;mxCell parent="1" style="machine_task" vertex="1"&gt;&lt;mxGeometry as="geometry" height="60.0" width="160.0" x="170.0" y="52.0"/&gt;&lt;/mxCell&gt;&lt;/MachineTask&gt;&lt;/root&gt;&lt;/mxGraphModel&gt;</compositeStructureXml>
                     <description>Business Process description</description>
                     <executingType>COMPOSITE</executingType>
                     <goldBucketBlockSize>0</goldBucketBlockSize>
                     <goldRatio>0</goldRatio>
                     <goldSource>Empty</goldSource>
                     <goldType>Percentage</goldType>
                     <moderation>false</moderation>
                     <origination>CREATED_AUTOMATICALLY</origination>
                     <question>
                        <answers>
                           <answer>
                              <allowNA>false</allowNA>
                              <answer>TOOD</answer>
                              <answerCode>ocr_document_url</answerCode>
                              <answerHtml/>
                              <answerTypeObject>
                                 <answerTypeGroup>ADVANCED</answerTypeGroup>
                                 <code>INFO_EXTRACTION</code>
                                 <description/>
                                 <optionsAvailable>true</optionsAvailable>
                                 <showDefaultValue>true</showDefaultValue>
                                 <showForFieldScheme>false</showForFieldScheme>
                                 <showForHumanTask>true</showForHumanTask>
                                 <showForMachineConfig>false</showForMachineConfig>
                                 <title>Information Extraction</title>
                                 <valueType>SINGLEVALUE</valueType>
                              </answerTypeObject>
                              <appendDataStoreOptions>false</appendDataStoreOptions>
                              <autocompleteField>false</autocompleteField>
                              <category/>
                              <constantable>false</constantable>
                              <defaultValue/>
                              <doNotNormalizeTaggedText>false</doNotNormalizeTaggedText>
                              <doNotUseInAdjudication>false</doNotUseInAdjudication>
                              <findMajorityForAllAtomicValues>false</findMajorityForAllAtomicValues>
                              <htmlClasses/>
                              <lastModified>2018-05-29T09:25:58Z</lastModified>
                              <letCustomValues>false</letCustomValues>
                              <manualField>false</manualField>
                              <multiValue>false</multiValue>
                              <options>{"ieExtractorType":"ORIGINAL_APPEARANCE_EXTRACTOR"}</options>
                              <originalDocumentSource>${question.data['original_document_url']}</originalDocumentSource>
                              <percentRequired>false</percentRequired>
                              <range>false</range>
                              <required>false</required>
                              <sequenceNumber>1</sequenceNumber>
                              <useBlocks>false</useBlocks>
                              <useEmptyCell>false</useEmptyCell>
                           </answer>
                           <answer>
                              <allowNA>false</allowNA>
                              <answer>Text</answer>
                              <answerCode>answ_test_text</answerCode>
                              <answerHtml/>
                              <answerTypeObject>
                                 <answerTypeGroup>UNCONSTRAINED_TEXT</answerTypeGroup>
                                 <code>FREE_TEXT</code>
                                 <description/>
                                 <optionsAvailable>false</optionsAvailable>
                                 <showDefaultValue>true</showDefaultValue>
                                 <showForFieldScheme>true</showForFieldScheme>
                                 <showForHumanTask>true</showForHumanTask>
                                 <showForMachineConfig>true</showForMachineConfig>
                                 <title>Free Text</title>
                                 <valueType>SINGLEVALUE</valueType>
                              </answerTypeObject>
                              <appendDataStoreOptions>false</appendDataStoreOptions>
                              <autocompleteField>false</autocompleteField>
                              <constantable>false</constantable>
                              <doNotNormalizeTaggedText>false</doNotNormalizeTaggedText>
                              <doNotUseInAdjudication>false</doNotUseInAdjudication>
                              <findMajorityForAllAtomicValues>false</findMajorityForAllAtomicValues>
                              <hotKey>T</hotKey>
                              <lastModified>2018-06-04T09:38:58Z</lastModified>
                              <letCustomValues>false</letCustomValues>
                              <manualField>false</manualField>
                              <multiValue>false</multiValue>
                              <parentAnswer>
                                 <allowNA>false</allowNA>
                                 <answer>TOOD</answer>
                                 <answerCode>ocr_document_url</answerCode>
                                 <answerHtml/>
                                 <answerTypeObject>
                                    <answerTypeGroup>ADVANCED</answerTypeGroup>
                                    <code>INFO_EXTRACTION</code>
                                    <description/>
                                    <optionsAvailable>true</optionsAvailable>
                                    <showDefaultValue>true</showDefaultValue>
                                    <showForFieldScheme>false</showForFieldScheme>
                                    <showForHumanTask>true</showForHumanTask>
                                    <showForMachineConfig>false</showForMachineConfig>
                                    <title>Information Extraction</title>
                                    <valueType>SINGLEVALUE</valueType>
                                 </answerTypeObject>
                                 <appendDataStoreOptions>false</appendDataStoreOptions>
                                 <autocompleteField>false</autocompleteField>
                                 <category/>
                                 <constantable>false</constantable>
                                 <defaultValue/>
                                 <doNotNormalizeTaggedText>false</doNotNormalizeTaggedText>
                                 <doNotUseInAdjudication>false</doNotUseInAdjudication>
                                 <findMajorityForAllAtomicValues>false</findMajorityForAllAtomicValues>
                                 <htmlClasses/>
                                 <lastModified>2018-05-29T09:25:58Z</lastModified>
                                 <letCustomValues>false</letCustomValues>
                                 <manualField>false</manualField>
                                 <multiValue>false</multiValue>
                                 <options>{"ieExtractorType":"ORIGINAL_APPEARANCE_EXTRACTOR"}</options>
                                 <originalDocumentSource>${question.data['original_document_url']}</originalDocumentSource>
                                 <percentRequired>false</percentRequired>
                                 <range>false</range>
                                 <required>false</required>
                                 <sequenceNumber>1</sequenceNumber>
                                 <useBlocks>false</useBlocks>
                                 <useEmptyCell>false</useEmptyCell>
                              </parentAnswer>
                              <percentRequired>false</percentRequired>
                              <range>false</range>
                              <required>true</required>
                              <sequenceNumber>2</sequenceNumber>
                              <useBlocks>false</useBlocks>
                              <useEmptyCell>false</useEmptyCell>
                           </answer>
                        </answers>
                        <assignmentDuration>1800000</assignmentDuration>
                        <assignmentLimit>1</assignmentLimit>
                        <attrs>{"lnaa":"Run","lnam":"Tasks","lna":"0"}</attrs>
                        <autoApprovalDelay>432000000</autoApprovalDelay>
                        <automaticallyProcessed>0</automaticallyProcessed>
                        <blockSize>1</blockSize>
                        <constQualifiedWorkers>false</constQualifiedWorkers>
                        <currency>USD</currency>
                        <description>Miscellaneous Tasks</description>
                        <dynamicTaskRenderingDisabled>true</dynamicTaskRenderingDisabled>
                        <expiredTime>2592000000</expiredTime>
                        <faqItems/>
                        <frameHeight>2500</frameHeight>
                        <geolocationEnabled>false</geolocationEnabled>
                        <instructionItems/>
                        <keywords>Miscellaneous Tasks</keywords>
                        <maxAssignments>1</maxAssignments>
                        <moderation>false</moderation>
                        <moderationFlag>false</moderationFlag>
                        <origination>CREATED_MANUALLY</origination>
                        <pendingAssignmentsLimit>10</pendingAssignmentsLimit>
                        <qualificationInstruction/>
                        <qualificationRequirements/>
                        <qualificationRequirementsRequiredForPreview>false</qualificationRequirementsRequiredForPreview>
                        <qualificationTasks>20</qualificationTasks>
                        <qualificationTraining>false</qualificationTraining>
                        <questionRuleMaps>
                           <questionRuleMap>
                              <businessRule>
                                 <content>

package com.freedomoss.requester;

#list any import classes here.
import com.freedomoss.objective.model.RuleContext;
import com.freedomoss.objective.model.RuleContext.MajorityType;
import com.freedomoss.objective.model.RuleAssigmentContext;
import com.freedomoss.objective.model.RuleQuestionContext;
import com.freedomoss.requester.model.AwsHitQuestion;
import com.freedomoss.requester.model.AwsHitQuestionItem;
import com.freedomoss.requester.model.AwsHitQuestionAnswerItem;

import org.slf4j.Logger;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;
import java.util.Map;
import java.util.Iterator;

#declare any global variables here
global RuleContext source
global Logger log
global Map params


rule "Rule context initialization"
auto-focus true
no-loop
dialect "mvel"
agenda-group "initialization-group"
	when
		$ctx:RuleContext(initialized == false);
	then
	    # set parameters

        $ctx.properties[RuleContext.MAJORITY_TYPE] =  RuleContext.MajorityType.COUNT;
        $ctx.properties[RuleContext.MAJORITY_VALUE] = new Integer(1);

        #$ctx.properties[RuleContext.MAX_ASSIGNMENT_LIMIT] = new Integer(1);
        $ctx.properties[RuleContext.MAJORITY_HIT_THRESHOLD] = new Double(100/100);
        $ctx.properties[RuleContext.ASSIGNMENT_APPROVE_THRESHOLD] = new Double(0.5);

        # insert processed facts into memory
        $ctx.updateWorkingMemory();
        # move to business rules
        kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup("calculation").setFocus();
        $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Worst accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 70 if gold accuracy goes up &lt; 75 percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp; $campaignStatistic.goldAccuracy &lt; (75/100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 70);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Normal accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 80 if gold accuracy goes up &gt;= 75 percents and &lt; 90"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= (75/ 100) &amp;&amp; $campaignStatistic.goldAccuracy &lt; (90 / 100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 80);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Super accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 95 if gold accuracy goes up &gt;= 90 percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= (90 / 100) )
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 95);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "0. Check, if exist majority"
agenda-group "calculation"
dialect "mvel"
salience 100
no-loop
	when
	    $ctx:RuleContext (initialized == true, $gold:gold, $threshold:properties.MAJORITY_HIT_THRESHOLD)
        eval($ctx.majorityWithoutGold().size() &gt;= ($ctx.questions.size() - $gold.size()) *  $threshold)
	then
		insert(new String("MAJORITY_FOUND"));
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "1. Approve question by majority"
agenda-group "calculation"
dialect "mvel"
salience 90
no-loop
	when
		((String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true))
		or
		(not String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true, assignments.size == properties.MAX_ASSIGNMENT_LIMIT)))
		$rqc:RuleQuestionContext()
	then
		$rqc.approveQuestion($ctx.majority());
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rqc);
end

rule "3. Approve assignment (always)"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		$ctx:RuleContext(initialized == true, $threshold:properties.ASSIGNMENT_APPROVE_THRESHOLD)
		$rac:RuleAssigmentContext()
	then
	    insert(new String("ASSIGNMENT_PROCESSED"));
		$ctx.addApproved($rac);
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rac);
end

rule "5. Extend HIT"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		not String(toString == "MAJORITY_FOUND")
		$ctx:RuleContext(initialized == true, assignments.size &lt; properties.MAX_ASSIGNMENT_LIMIT);
	then
		$ctx.setExtendHit(true);
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

</content>
                                 <name>Start with one assignment 1+0 pay all</name>
                                 <paramValues>{"NORMAL_ACCURACY_LEVEL_SCORE":"80","NORMAL_ACCURACY_LEVEL_UPPER_LIMIT":"90","WORST_ACCURACY_LEVEL_SCORE":"70","MAJORITY_HIT_THRESHOLD":"100","SUPER_ACCURACY_LEVEL_LOWER_LIMIT":"90","WORST_ACCURACY_LEVEL_UPPER_LIMIT":"75","SUPER_ACCURACY_LEVEL_SCORE":"95","NORMAL_ACCURACY_LEVEL_LOWER_LIMIT":"75","MAJORITY_VALUE":"1","CHECK_EVERY":"5","MAX_ASSIGNMENT_LIMIT":"1"}</paramValues>
                                 <ruleType>DROOLS</ruleType>
                                 <ruleTypeUI>Adjudication</ruleTypeUI>
                                 <template>
                                    <content>

package com.freedomoss.requester;

#list any import classes here.
import com.freedomoss.objective.model.RuleContext;
import com.freedomoss.objective.model.RuleContext.MajorityType;
import com.freedomoss.objective.model.RuleAssigmentContext;
import com.freedomoss.objective.model.RuleQuestionContext;
import com.freedomoss.requester.model.AwsHitQuestion;
import com.freedomoss.requester.model.AwsHitQuestionItem;
import com.freedomoss.requester.model.AwsHitQuestionAnswerItem;

import org.slf4j.Logger;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;
import java.util.Map;
import java.util.Iterator;

#declare any global variables here
global RuleContext source
global Logger log
global Map params


rule "Rule context initialization"
auto-focus true
no-loop
dialect "mvel"
agenda-group "initialization-group"
	when
		$ctx:RuleContext(initialized == false);
	then
	    # set parameters

        $ctx.properties[RuleContext.MAJORITY_TYPE] =  RuleContext.MajorityType.COUNT;
        $ctx.properties[RuleContext.MAJORITY_VALUE] = new Integer({{MAJORITY_VALUE}});

        #$ctx.properties[RuleContext.MAX_ASSIGNMENT_LIMIT] = new Integer({{MAX_ASSIGNMENT_LIMIT}});
        $ctx.properties[RuleContext.MAJORITY_HIT_THRESHOLD] = new Double({{MAJORITY_HIT_THRESHOLD}}/100);
        $ctx.properties[RuleContext.ASSIGNMENT_APPROVE_THRESHOLD] = new Double(0.5);

        # insert processed facts into memory
        $ctx.updateWorkingMemory();
        # move to business rules
        kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup("calculation").setFocus();
        $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Worst accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{WORST_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &lt; {{WORST_ACCURACY_LEVEL_UPPER_LIMIT}} percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp; $campaignStatistic.goldAccuracy &lt; ({{WORST_ACCURACY_LEVEL_UPPER_LIMIT}}/100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{WORST_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Normal accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{NORMAL_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &gt;= {{NORMAL_ACCURACY_LEVEL_LOWER_LIMIT}} percents and &lt; {{NORMAL_ACCURACY_LEVEL_UPPER_LIMIT}}"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= ({{NORMAL_ACCURACY_LEVEL_LOWER_LIMIT}}/ 100) &amp;&amp; $campaignStatistic.goldAccuracy &lt; ({{NORMAL_ACCURACY_LEVEL_UPPER_LIMIT}} / 100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{NORMAL_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Super accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{SUPER_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &gt;= {{SUPER_ACCURACY_LEVEL_LOWER_LIMIT}} percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= ({{SUPER_ACCURACY_LEVEL_LOWER_LIMIT}} / 100) )
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{SUPER_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "0. Check, if exist majority"
agenda-group "calculation"
dialect "mvel"
salience 100
no-loop
	when
	    $ctx:RuleContext (initialized == true, $gold:gold, $threshold:properties.MAJORITY_HIT_THRESHOLD)
        eval($ctx.majorityWithoutGold().size() &gt;= ($ctx.questions.size() - $gold.size()) *  $threshold)
	then
		insert(new String("MAJORITY_FOUND"));
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "1. Approve question by majority"
agenda-group "calculation"
dialect "mvel"
salience 90
no-loop
	when
		((String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true))
		or
		(not String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true, assignments.size == properties.MAX_ASSIGNMENT_LIMIT)))
		$rqc:RuleQuestionContext()
	then
		$rqc.approveQuestion($ctx.majority());
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rqc);
end

rule "3. Approve assignment (always)"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		$ctx:RuleContext(initialized == true, $threshold:properties.ASSIGNMENT_APPROVE_THRESHOLD)
		$rac:RuleAssigmentContext()
	then
	    insert(new String("ASSIGNMENT_PROCESSED"));
		$ctx.addApproved($rac);
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rac);
end

rule "5. Extend HIT"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		not String(toString == "MAJORITY_FOUND")
		$ctx:RuleContext(initialized == true, assignments.size &lt; properties.MAX_ASSIGNMENT_LIMIT);
	then
		$ctx.setExtendHit(true);
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

</content>
                                    <description>Get qualified workers: pay if ${MAJORITY_VALUE} correct answers, start with 1 assignment, extend to maximum of ${MAX_ASSIGNMENT_LIMIT} assignments. Set qualification scores depending on gold accuracy.</description>
                                    <name>Start with 1 assignment X+0 rule (pay all)</name>
                                    <params>
                                       <param>
                                          <code>CHECK_EVERY</code>
                                          <defaultValue>5</defaultValue>
                                          <description>Check every i-th gold question when evaluating qualification score</description>
                                          <name>Check every i-th gold question</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>MAX_ASSIGNMENT_LIMIT</code>
                                          <defaultValue>1</defaultValue>
                                          <description>Maximum number of assignments</description>
                                          <name>Max assignments limit</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>NORMAL_ACCURACY_LEVEL_SCORE</code>
                                          <defaultValue>80</defaultValue>
                                          <description>Qualification score will be given to a worker who has demonstrated a normal accuracy</description>
                                          <name>Normal accuracy level score</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>NORMAL_ACCURACY_LEVEL_LOWER_LIMIT</code>
                                          <defaultValue>75</defaultValue>
                                          <description>Normal accuracy level lower limit in percents inclusive</description>
                                          <name>Normal accuracy level lower limit</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>WORST_ACCURACY_LEVEL_UPPER_LIMIT</code>
                                          <defaultValue>75</defaultValue>
                                          <description>Worst accuracy level upper limit in percents exclusive, lower limit is considered as 0</description>
                                          <name>Worst accuracy level upper limit</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>SUPER_ACCURACY_LEVEL_SCORE</code>
                                          <defaultValue>95</defaultValue>
                                          <description>Qualification score will be given to a worker who has demonstrated a super accuracy</description>
                                          <name>Super accuracy level score</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>MAJORITY_HIT_THRESHOLD</code>
                                          <defaultValue>100</defaultValue>
                                          <description>Percent (from 0 to 100) of correct answers when  majority is found</description>
                                          <name>Percent of correct answers</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>NORMAL_ACCURACY_LEVEL_UPPER_LIMIT</code>
                                          <defaultValue>90</defaultValue>
                                          <description>Normal accuracy level upper limit in percents exclusive</description>
                                          <name>Normal accuracy level upper limit</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>SUPER_ACCURACY_LEVEL_LOWER_LIMIT</code>
                                          <defaultValue>90</defaultValue>
                                          <description>Super accuracy level lower limit in percents inclusive, upper limit is considered as 100</description>
                                          <name>Super accuracy level lower limit</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>MAJORITY_VALUE</code>
                                          <defaultValue>1</defaultValue>
                                          <description>Number of correct answers</description>
                                          <name>Majority value</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>WORST_ACCURACY_LEVEL_SCORE</code>
                                          <defaultValue>70</defaultValue>
                                          <description>Qualification score will be given to a worker who has demonstrated a low accuracy</description>
                                          <name>Worst accuracy level score</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                    </params>
                                 </template>
                                 <uuid>84e370ab-7f81-11e8-80bc-0ae8ba3240ae</uuid>
                                 <workflowRuleMode>ADVANCED</workflowRuleMode>
                              </businessRule>
                           </questionRuleMap>
                        </questionRuleMaps>
                        <radiusSelector>ExactLocation</radiusSelector>
                        <randomizeAnswers>false</randomizeAnswers>
                        <recursiveThreshold>1</recursiveThreshold>
                        <restrictedCountries/>
                        <taskNotificationSchedule>IMMEDIATE</taskNotificationSchedule>
                        <templates>
                           <template>
                              <code/>
                              <content>&lt;#include "extras.ftl" parse=true/&gt;
&lt;#include "html.ftl" parse=true/&gt;
&lt;#include "answers.ftl" parse=true/&gt;
&lt;#assign FEEDBACK_ENABLED = true&gt;
&lt;!-- v 1.9 --&gt;
&lt;@hit contentCss="${applicationResourceUrl}/workfusion-resources/saas/ms/ms.bootstrap.min.css"&gt;
&lt;@script src="${applicationResourceUrl}/workfusion-resources/bootstrap/js/bootstrap-tab.js"/&gt;  
  
&lt;style type="text/css"&gt;
    document {
        background: none !important;
        overflow: visible!important;
        padding: 0 !important;
        position: absolute !important;
        left: 0;
        top: 0;
        width: 100%;
    }
    page {
        box-shadow: none !important;
        background: none !important;
        padding: 0 !important;
        margin: 0 !important;
        overflow: visible!important;
        height: 0 !important;
    }
    cell, document td {
        border: 0 !important;
    }
    block[blocktype="Picture"] {
        opacity: 1 !important;
        background: none !important;
    }
    .hidden_field {display:none; }
    .hidden {display:inline-block !important;}
    .extraction-content {padding: 0 !important;}
  	.ie-view-source {
  		display: none;
  	}
  	.ie-view-source + .ie-zoom-in-zoom-out-separator {
  		display: none !important;
  	}
  	.popup-original-document.ml10 {
  		margin-left: 0 !important;
  	}
    .opacity-control {
        float: left;
        line-height: 40px;
        margin-left: 3px;
    }
    .opacity-control span {
        display: inline-block;
    }
    #rangeInput {
        width: 100px;
        box-shadow: none;
        margin: -1px 0 0 10px;
        border: 0;
    }
    #rangeInput::-moz-focus-outer {
        border: 0;
    }
&lt;/style&gt;
 
&lt;script type="text/javascript"&gt;
    $(document).ready(function() {
        
        if (document.getElementsByClassName('submit-btn').length) {
            var originalSubmitEvent = document.getElementsByClassName('submit-btn')[0].onclick;
            document.getElementsByClassName('submit-btn')[0].onclick = function(){
                preprocessAppendOrder();
                originalSubmitEvent();
            }
        }
       
        var originalOnTextContainerLoad = ExtractionAnswerController.prototype.onTextContainerLoad;
        ExtractionAnswerController.prototype.onTextContainerLoad = function() {
            try {
            originalOnTextContainerLoad.apply(this, arguments);
            scrollingDiv=document.getElementsByClassName('extraction-body')[0];
          	divTop = scrollingDiv.offsetTop;
            while (scrollingDiv.offsetParent) {
            	scrollingDiv = scrollingDiv.offsetParent;
                divTop += scrollingDiv.offsetTop;
            }
            scrollingDiv=document.getElementsByClassName('extraction-body')[0];
            divArray = scrollingDiv.getElementsByTagName("div");
            divSizes(null);
            document.onscroll=divSizes;
            scrollingDiv.onscroll=divSizes;
            document.onkeyup=keyupHandler;
            scrollingDiv.onkeyup=keyupHandler;
            var minusButton=document.getElementsByClassName('ie-zoom-in')[0];
            var plusButton=document.getElementsByClassName('ie-zoom-out')[0];
            minusButton.onclick=out;
            plusButton.onclick=in;
            var $textContainer = ExtractionAnswer.getExtractionController().$textContainer;
            console.log("Before if");
            if ($textContainer.find('document')) {
            	console.log("Before init");
                initOpacity();
            	console.log("After init");
              	var $page = $textContainer.find('page').eq(0);
                scale = parseFloat((1/(parseInt($page.attr('width'))/$page.width())).toFixed(1));
                $textContainer.css({'transform':'scaleX(' + scale +') scaleY(' + scale + ') translateZ(0)'});
      		}
            } catch (e){
              console.log("onTextContainerLoad "+e);
            }
        };
    });
  
    var OpacityElements = {
        image: $([]),
        textContainer: $([])
    };
  
    function out(){
    	scale=scale-scale*0.1;
        zoom(scale);
    }
  
    function in(){
    	scale=scale+scale*0.1;
        zoom(scale);
    }
  
    function zoom(scale){
        var $textContainer = ExtractionAnswer.getExtractionController().$textContainer;
		$textContainer.css({'transform':'scaleX(' + scale +') scaleY(' + scale + ') translateZ(0)'});
    }
  
    function keyupHandler(){
       try {
         if (event.keyCode==67){
         	document.getElementById('checkInput').checked=!document.getElementById('checkInput').checked;
            if (document.getElementById('checkInput').checked) {
              OpacityElements.image.css('opacity', 1);
        	} else {
              OpacityElements.image.css('opacity', 0);
        	}

            var divArray=scrollingDiv.getElementsByClassName("n");
        	var i;
        	for (i in divArray) {
          		var divWithText = divArray[i];
      			if (document.getElementById('checkInput').checked) {
              		divWithText.style.opacity="0";
        		} else {
              		divWithText.style.opacity="1";
        		}
        	}
         }
       } catch (e){
       }
    }
  
	var scale = 1;
    var divTop;
    var divArray;
    var scrollingDiv;
    var isComputing = false;
    var counter = 0;
    var isWidthChanged = false;
    var elementSet = new Set();

    function divSizes(ev) {
    	if (!isComputing) {
        	counter++;
            isComputing = true;
            try {
                if (ev!=null)
                	ev.cancelBubble=true;
            	
                var i;
                isWidthChanged = false;
                for (i in divArray) {
                	try {
                    	var divWithText = divArray[i];
                    	if (!elementSet.has(divWithText)) {
                        	if (elementInViewport(divWithText)) {
                        		divSize(divWithText);
                        	}
                    	}
                    } catch (ex) {
                    }
                }
            } catch (e) {
            }
            isComputing = false;
        }
    }

                    function divSize(divWithText) {
                    	try {
                    		if (divWithText.className == "n") {
                    			var divWithTextFontHeight = divWithText.style.fontSize.replace("px", "");
                    			var divWithTextWidth = divWithText.style.width.replace("px", "");
                    			var divWithTextScrollWidth = divWithText.scrollWidth;
                    			var divWithTextHeight = divWithText.style.height.replace("px", "");
                    			var divWithTextScrollHeight = divWithText.scrollHeight;
                                var widthDiff=divWithTextScrollWidth-divWithTextWidth;
                                var heightDiff=divWithTextScrollHeight-divWithTextHeight;

                              if ((widthDiff&gt;0) || (heightDiff&gt;0)) {
                    				var updatedFontSizeWidth = divWithTextFontHeight * divWithTextWidth / divWithTextScrollWidth;
                    				var updatedFontSizeHeight = divWithTextFontHeight * divWithTextHeight / divWithTextScrollHeight;
                    				var updatedFontSize = Math.min(updatedFontSizeWidth, updatedFontSizeHeight);
                    				divWithText.style.fontSize = updatedFontSize + "px";
                          			elementSet.add(divWithText);
                    				isWidthChanged = true;
                    			}
                    		}
                    	}
                    	catch (e) {
                    	}
                    }

                    function elementInViewport(inputElement) {
                      	try{

                        var startInputElement=inputElement;  
                      	var top = inputElement.offsetTop;
                    	var height = inputElement.offsetHeight;
                    	while (inputElement.offsetParent) {
                    		inputElement = inputElement.offsetParent;
                    		top += inputElement.offsetTop;
                    	}
                        var windowPageYOffset=window.pageYOffset+scrollingDiv.scrollTop+divTop;
                        return (top &gt;= windowPageYOffset &amp;&amp; /*left &gt;= windowPageXOffset &amp;&amp;*/ (top + height) &lt;= (windowPageYOffset/10*15 + window.innerHeight*3) /*&amp;&amp; (left + width) &lt;= (windowPageXOffset + frameWindow.innerWidth)*/);
                        } catch (e){
                        	return false;
                        }
                    }

   
    function initOpacity() {
        try {
       	console.log("Init start");
        document.getElementsByClassName('ie-zoom-out')[0].outerHTML=document.getElementsByClassName('ie-zoom-out')[0].outerHTML+'&lt;div class="toolbar-boundary"&gt;&lt;/div&gt;&lt;div class="opacity-control"&gt;&lt;label accesskey="c"&gt;Original document:&lt;/label&gt;&lt;input type="checkbox" id="checkInput" value="yes"/&gt;&lt;/div&gt;';
       	console.log("After get");
        OpacityElements.image = $('.extraction-content img');
        OpacityElements.textContainer = $('.extraction-content page');
      	OpacityElements.image.css('opacity', 0);
        $('#checkInput').on('click', changeOpacity);
        document.getElementById('checkInput').focus();
        var divArray=scrollingDiv.getElementsByClassName("n");
        var i;
        for (i in divArray) {
          try{
          var divWithText = divArray[i];
          divWithText.style.opacity="1";
          } catch (e){
          }
        }
        } catch (ex){
        	console.log("Init "+ex);
        }
    }
   
    function changeOpacity() {
        try {
        var i;
        var divArray=scrollingDiv.getElementsByClassName("n");
      		if (this.checked) {
              OpacityElements.image.css('opacity', 1);
        	} else {
              OpacityElements.image.css('opacity', 0);
        	}
        for (i in divArray) {
          var divWithText = divArray[i];
      		if (this.checked) {
              divWithText.style.opacity="0";
        	} else {
              divWithText.style.opacity="1";
        	}
        }
        } catch (e){
        }
    }
   
    function preprocessAppendOrder() {
        var appendOrder = 0;
        var controllers = Answers.getTaggingControllers();
        controllers.forEach(function(controller) {
            var $tags = DocumentContainer.getControllerTag(controller);
            if ($tags.length) {
                for (var i = 0, l = $tags.length; i &lt; l; i++) {
                    $tags.eq(i).attr('appendorder', nextAppendOrder());
                }
            }
        });
       
        function nextAppendOrder () {
            return ++appendOrder;
        }
    }
&lt;/script&gt;
  
&lt;@instructions title="&lt;h3 id='TaggingOverOriginalDocument-Step6:[TOOD][HT][BASE]TaggingOverOriginalDocument'&gt;[TOOD][MT][BASE] Tagging Over Original Document&lt;/h3&gt;"&gt;
  &lt;!--- editable content --&gt;
  &lt;@editable id="__INSTRUCTIONS__"&gt;&lt;br&gt;&lt;br&gt;&lt;/@editable&gt;
&lt;/@instructions&gt;
&lt;@form&gt;
&lt;#if questions??&gt;
    &lt;div class="thumbnail"&gt;
    &lt;#list questions as question&gt;
      &lt;@report question=question includeAll=true/&gt;
      &lt;div style="position:relative;margin:2px 0px" class="block question"&gt;
           &lt;div style="position:absolute;top:0px;right:0px;background-color:#e0e0e0;padding:1px 4px;border: 1px solid #C0C0C0;border-radius: 0px" class="number"&gt;
                &lt;b&gt;${question_index + 1}&lt;/b&gt;
           &lt;/div&gt;
           &lt;div&gt;
               &lt;div class="place bg-dark"&gt;
                 &lt;@editable id="__DATA__"&gt;&lt;br data-mce-bogus="1"&gt;&lt;/@editable&gt;
               &lt;/div&gt;
               &lt;div class="place"&gt;
                 &lt;@answers question=question/&gt;
               &lt;/div&gt;
            &lt;/div&gt;
      &lt;/div&gt;
    &lt;/#list&gt;
    &lt;/div&gt;
&lt;/#if&gt;
&lt;@submit text="Submit" /&gt;
&lt;/@form&gt;
&lt;/@hit&gt;</content>
                              <name>[TOOD] Document Tagging Sample</name>
                              <origination>CREATED_AUTOMATICALLY</origination>
                              <status>ACTIVE</status>
                              <type>TASK</type>
                              <uuid>7b12f633-0836-4afe-b029-8a566fd4fe57</uuid>
                              <version>
                                 <componentUuid>31fd0d05-0791-4083-b461-db3324593e33</componentUuid>
                                 <incrementalVersion>1.1</incrementalVersion>
                                 <lastInChain>true</lastInChain>
                                 <lastModified>2018-07-11T10:23:40Z</lastModified>
                                 <versionUuid>b067b09c-3874-4e21-84d5-34634cc68420</versionUuid>
                              </version>
                           </template>
                        </templates>
                        <title>[TOOD][MT][BASE] Tagging Over Original Document</title>
                        <useCommonHitCoordinates>true</useCommonHitCoordinates>
                        <uuid>137fcdcc-eae5-47d0-a0e4-747acd340ecd</uuid>
                        <version>
                           <componentUuid>bf1e2eae-20ae-4948-9aaa-43716e85d596</componentUuid>
                           <incrementalVersion>1.1</incrementalVersion>
                           <lastInChain>true</lastInChain>
                           <lastModified>2018-07-11T10:23:40Z</lastModified>
                           <versionUuid>34080ef0-322e-41fb-a843-1aee1d78c056</versionUuid>
                        </version>
                        <workSetting>
                           <category>
                              <automation>false</automation>
                              <description/>
                              <enabled>true</enabled>
                              <executingType>HUMAN</executingType>
                              <name>Other</name>
                              <private>false</private>
                              <publicId>dd92f240-144b-4fef-8476-4ec0acbc1104</publicId>
                           </category>
                           <contentType>BLANK</contentType>
                           <description/>
                           <enabled>true</enabled>
                           <name>Miscellaneous Tasks</name>
                           <publicId>26e6e095-00bb-43fa-8c34-af0b18e71ac8</publicId>
                           <version>
                              <componentUuid>26e6e095-00bb-43fa-8c34-af0b18e71ac8</componentUuid>
                              <incrementalVersion>1.0</incrementalVersion>
                              <lastInChain>true</lastInChain>
                              <lastModified>2018-07-04T11:58:04Z</lastModified>
                              <versionUuid>26e6e095-00bb-43fa-8c34-af0b18e71ac8</versionUuid>
                           </version>
                           <answers/>
                           <businessRules>
                              <businessRule>
                                 <content>

package com.freedomoss.requester;

#list any import classes here.
import com.freedomoss.objective.model.RuleContext;
import com.freedomoss.objective.model.RuleContext.MajorityType;
import com.freedomoss.objective.model.RuleAssigmentContext;
import com.freedomoss.objective.model.RuleQuestionContext;
import com.freedomoss.requester.model.AwsHitQuestion;
import com.freedomoss.requester.model.AwsHitQuestionItem;
import com.freedomoss.requester.model.AwsHitQuestionAnswerItem;

import org.slf4j.Logger;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;
import java.util.Map;
import java.util.Iterator;

#declare any global variables here
global RuleContext source
global Logger log
global Map params


rule "Rule context initialization"
auto-focus true
no-loop
dialect "mvel"
agenda-group "initialization-group"
	when
		$ctx:RuleContext(initialized == false);
	then
	    # set parameters

        $ctx.properties[RuleContext.MAJORITY_TYPE] =  RuleContext.MajorityType.COUNT;
        $ctx.properties[RuleContext.MAJORITY_VALUE] = new Integer(1);

        #$ctx.properties[RuleContext.MAX_ASSIGNMENT_LIMIT] = new Integer(1);
        $ctx.properties[RuleContext.MAJORITY_HIT_THRESHOLD] = new Double(100/100);
        $ctx.properties[RuleContext.ASSIGNMENT_APPROVE_THRESHOLD] = new Double(0.5);

        # insert processed facts into memory
        $ctx.updateWorkingMemory();
        # move to business rules
        kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup("calculation").setFocus();
        $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Worst accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 70 if gold accuracy goes up &lt; 75 percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp; $campaignStatistic.goldAccuracy &lt; (75/100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 70);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Normal accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 80 if gold accuracy goes up &gt;= 75 percents and &lt; 90"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= (75/ 100) &amp;&amp; $campaignStatistic.goldAccuracy &lt; (90 / 100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 80);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Super accuracy rule-Evaluate every 5 gold question and set Accuracy based qualification score to 95 if gold accuracy goes up &gt;= 90 percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  5) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= (90 / 100) )
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, 95);
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "0. Check, if exist majority"
agenda-group "calculation"
dialect "mvel"
salience 100
no-loop
	when
	    $ctx:RuleContext (initialized == true, $gold:gold, $threshold:properties.MAJORITY_HIT_THRESHOLD)
        eval($ctx.majorityWithoutGold().size() &gt;= ($ctx.questions.size() - $gold.size()) *  $threshold)
	then
		insert(new String("MAJORITY_FOUND"));
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "1. Approve question by majority"
agenda-group "calculation"
dialect "mvel"
salience 90
no-loop
	when
		((String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true))
		or
		(not String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true, assignments.size == properties.MAX_ASSIGNMENT_LIMIT)))
		$rqc:RuleQuestionContext()
	then
		$rqc.approveQuestion($ctx.majority());
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rqc);
end

rule "3. Approve assignment (always)"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		$ctx:RuleContext(initialized == true, $threshold:properties.ASSIGNMENT_APPROVE_THRESHOLD)
		$rac:RuleAssigmentContext()
	then
	    insert(new String("ASSIGNMENT_PROCESSED"));
		$ctx.addApproved($rac);
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rac);
end

rule "5. Extend HIT"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		not String(toString == "MAJORITY_FOUND")
		$ctx:RuleContext(initialized == true, assignments.size &lt; properties.MAX_ASSIGNMENT_LIMIT);
	then
		$ctx.setExtendHit(true);
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

</content>
                                 <name>Start with one assignment 1+0 pay all</name>
                                 <paramValues>{"NORMAL_ACCURACY_LEVEL_SCORE":"80","NORMAL_ACCURACY_LEVEL_UPPER_LIMIT":"90","WORST_ACCURACY_LEVEL_SCORE":"70","MAJORITY_HIT_THRESHOLD":"100","SUPER_ACCURACY_LEVEL_LOWER_LIMIT":"90","WORST_ACCURACY_LEVEL_UPPER_LIMIT":"75","SUPER_ACCURACY_LEVEL_SCORE":"95","NORMAL_ACCURACY_LEVEL_LOWER_LIMIT":"75","MAJORITY_VALUE":"1","CHECK_EVERY":"5","MAX_ASSIGNMENT_LIMIT":"1"}</paramValues>
                                 <ruleType>DROOLS</ruleType>
                                 <ruleTypeUI>Adjudication</ruleTypeUI>
                                 <template>
                                    <content>

package com.freedomoss.requester;

#list any import classes here.
import com.freedomoss.objective.model.RuleContext;
import com.freedomoss.objective.model.RuleContext.MajorityType;
import com.freedomoss.objective.model.RuleAssigmentContext;
import com.freedomoss.objective.model.RuleQuestionContext;
import com.freedomoss.requester.model.AwsHitQuestion;
import com.freedomoss.requester.model.AwsHitQuestionItem;
import com.freedomoss.requester.model.AwsHitQuestionAnswerItem;

import org.slf4j.Logger;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;
import java.util.Map;
import java.util.Iterator;

#declare any global variables here
global RuleContext source
global Logger log
global Map params


rule "Rule context initialization"
auto-focus true
no-loop
dialect "mvel"
agenda-group "initialization-group"
	when
		$ctx:RuleContext(initialized == false);
	then
	    # set parameters

        $ctx.properties[RuleContext.MAJORITY_TYPE] =  RuleContext.MajorityType.COUNT;
        $ctx.properties[RuleContext.MAJORITY_VALUE] = new Integer({{MAJORITY_VALUE}});

        #$ctx.properties[RuleContext.MAX_ASSIGNMENT_LIMIT] = new Integer({{MAX_ASSIGNMENT_LIMIT}});
        $ctx.properties[RuleContext.MAJORITY_HIT_THRESHOLD] = new Double({{MAJORITY_HIT_THRESHOLD}}/100);
        $ctx.properties[RuleContext.ASSIGNMENT_APPROVE_THRESHOLD] = new Double(0.5);

        # insert processed facts into memory
        $ctx.updateWorkingMemory();
        # move to business rules
        kcontext.getKnowledgeRuntime().getAgenda().getAgendaGroup("calculation").setFocus();
        $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Worst accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{WORST_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &lt; {{WORST_ACCURACY_LEVEL_UPPER_LIMIT}} percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp; $campaignStatistic.goldAccuracy &lt; ({{WORST_ACCURACY_LEVEL_UPPER_LIMIT}}/100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{WORST_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Normal accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{NORMAL_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &gt;= {{NORMAL_ACCURACY_LEVEL_LOWER_LIMIT}} percents and &lt; {{NORMAL_ACCURACY_LEVEL_UPPER_LIMIT}}"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= ({{NORMAL_ACCURACY_LEVEL_LOWER_LIMIT}}/ 100) &amp;&amp; $campaignStatistic.goldAccuracy &lt; ({{NORMAL_ACCURACY_LEVEL_UPPER_LIMIT}} / 100))
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{NORMAL_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "Super accuracy rule-Evaluate every {{CHECK_EVERY}} gold question and set Accuracy based qualification score to {{SUPER_ACCURACY_LEVEL_SCORE}} if gold accuracy goes up &gt;= {{SUPER_ACCURACY_LEVEL_LOWER_LIMIT}} percents"
agenda-group "calculation"
dialect "mvel"
salience 250
no-loop
 when
     $ctx:RuleContext(initialized == true)
     $rac:RuleAssigmentContext($campaignStatistic:campaignStatistic, runStatistic.totalGoldQuestions &gt; 0)
     #evaluate run average response time
     eval($campaignStatistic.totalGoldQuestions  &gt;  0 &amp;&amp;
         ($campaignStatistic.totalGoldQuestions  %  {{CHECK_EVERY}}) == 0 &amp;&amp;
          $campaignStatistic.goldAccuracy &gt;= ({{SUPER_ACCURACY_LEVEL_LOWER_LIMIT}} / 100) )
 then
     $rac.grandQualification(RuleContext.ACCURACY_BASED_QUALIFICATION, {{SUPER_ACCURACY_LEVEL_SCORE}});
     $ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "0. Check, if exist majority"
agenda-group "calculation"
dialect "mvel"
salience 100
no-loop
	when
	    $ctx:RuleContext (initialized == true, $gold:gold, $threshold:properties.MAJORITY_HIT_THRESHOLD)
        eval($ctx.majorityWithoutGold().size() &gt;= ($ctx.questions.size() - $gold.size()) *  $threshold)
	then
		insert(new String("MAJORITY_FOUND"));
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

rule "1. Approve question by majority"
agenda-group "calculation"
dialect "mvel"
salience 90
no-loop
	when
		((String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true))
		or
		(not String(toString == "MAJORITY_FOUND") and  $ctx:RuleContext (initialized == true, assignments.size == properties.MAX_ASSIGNMENT_LIMIT)))
		$rqc:RuleQuestionContext()
	then
		$rqc.approveQuestion($ctx.majority());
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rqc);
end

rule "3. Approve assignment (always)"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		$ctx:RuleContext(initialized == true, $threshold:properties.ASSIGNMENT_APPROVE_THRESHOLD)
		$rac:RuleAssigmentContext()
	then
	    insert(new String("ASSIGNMENT_PROCESSED"));
		$ctx.addApproved($rac);
		$ctx.logExecutedRule(kcontext.getRule().getName(), $rac);
end

rule "5. Extend HIT"
agenda-group "calculation"
dialect "mvel"
salience 50
no-loop
	when
		not String(toString == "MAJORITY_FOUND")
		$ctx:RuleContext(initialized == true, assignments.size &lt; properties.MAX_ASSIGNMENT_LIMIT);
	then
		$ctx.setExtendHit(true);
		$ctx.logExecutedRule(kcontext.getRule().getName());
end

</content>
                                    <description>Get qualified workers: pay if ${MAJORITY_VALUE} correct answers, start with 1 assignment, extend to maximum of ${MAX_ASSIGNMENT_LIMIT} assignments. Set qualification scores depending on gold accuracy.</description>
                                    <name>Start with 1 assignment X+0 rule (pay all)</name>
                                    <params>
                                       <param>
                                          <code>CHECK_EVERY</code>
                                          <defaultValue>5</defaultValue>
                                          <description>Check every i-th gold question when evaluating qualification score</description>
                                          <name>Check every i-th gold question</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>MAX_ASSIGNMENT_LIMIT</code>
                                          <defaultValue>1</defaultValue>
                                          <description>Maximum number of assignments</description>
                                          <name>Max assignments limit</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>NORMAL_ACCURACY_LEVEL_SCORE</code>
                                          <defaultValue>80</defaultValue>
                                          <description>Qualification score will be given to a worker who has demonstrated a normal accuracy</description>
                                          <name>Normal accuracy level score</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>NORMAL_ACCURACY_LEVEL_LOWER_LIMIT</code>
                                          <defaultValue>75</defaultValue>
                                          <description>Normal accuracy level lower limit in percents inclusive</description>
                                          <name>Normal accuracy level lower limit</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>WORST_ACCURACY_LEVEL_UPPER_LIMIT</code>
                                          <defaultValue>75</defaultValue>
                                          <description>Worst accuracy level upper limit in percents exclusive, lower limit is considered as 0</description>
                                          <name>Worst accuracy level upper limit</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>SUPER_ACCURACY_LEVEL_SCORE</code>
                                          <defaultValue>95</defaultValue>
                                          <description>Qualification score will be given to a worker who has demonstrated a super accuracy</description>
                                          <name>Super accuracy level score</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>MAJORITY_HIT_THRESHOLD</code>
                                          <defaultValue>100</defaultValue>
                                          <description>Percent (from 0 to 100) of correct answers when  majority is found</description>
                                          <name>Percent of correct answers</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>NORMAL_ACCURACY_LEVEL_UPPER_LIMIT</code>
                                          <defaultValue>90</defaultValue>
                                          <description>Normal accuracy level upper limit in percents exclusive</description>
                                          <name>Normal accuracy level upper limit</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>SUPER_ACCURACY_LEVEL_LOWER_LIMIT</code>
                                          <defaultValue>90</defaultValue>
                                          <description>Super accuracy level lower limit in percents inclusive, upper limit is considered as 100</description>
                                          <name>Super accuracy level lower limit</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>MAJORITY_VALUE</code>
                                          <defaultValue>1</defaultValue>
                                          <description>Number of correct answers</description>
                                          <name>Majority value</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                       <param>
                                          <code>WORST_ACCURACY_LEVEL_SCORE</code>
                                          <defaultValue>70</defaultValue>
                                          <description>Qualification score will be given to a worker who has demonstrated a low accuracy</description>
                                          <name>Worst accuracy level score</name>
                                          <type>INPUT_NUMBER</type>
                                       </param>
                                    </params>
                                 </template>
                                 <uuid>84e370ab-7f81-11e8-80bc-0ae8ba3240ae</uuid>
                                 <workflowRuleMode>ADVANCED</workflowRuleMode>
                              </businessRule>
                           </businessRules>
                           <isPrivate>false</isPrivate>
                           <items>
                              <item>
                                 <type>HIT_EXPIRES_IN</type>
                                 <value>2592000000</value>
                              </item>
                              <item>
                                 <type>AUTOMATICALLY_APPROVED</type>
                                 <value>432000000</value>
                              </item>
                              <item>
                                 <type>RECOMMENDATION_TAGS</type>
                                 <value>["information_extraction"]</value>
                              </item>
                              <item>
                                 <type>TIME_PER_ASSIGNMENT</type>
                                 <value>1800000</value>
                              </item>
                              <item>
                                 <type>TITLE</type>
                                 <value>Miscellaneous Tasks</value>
                              </item>
                           </items>
                           <template>
                              <code/>
                              <content>&lt;#include "extras.ftl" parse=true/&gt;
&lt;#include "html.ftl" parse=true/&gt;
&lt;#include "answers.ftl" parse=true/&gt;
&lt;#assign FEEDBACK_ENABLED = true&gt;

&lt;@hit contentCss="${applicationResourceUrl}/workfusion-resources/saas/ms/ms.bootstrap.min.css"&gt;
&lt;@script src="${applicationResourceUrl}/workfusion-resources/bootstrap/js/bootstrap-tab.js"/&gt;  
  

  
&lt;@instructions title="&lt;h2&gt;BLANK&lt;/h2&gt;"&gt;
  &lt;!--- editable content --&gt;
  &lt;@editable id="__INSTRUCTIONS__"&gt;&lt;br&gt;&lt;br&gt;&lt;/@editable&gt;
&lt;/@instructions&gt;
&lt;@form&gt;
&lt;#if questions??&gt;
    &lt;div class="thumbnail"&gt;
    &lt;#list questions as question&gt;
      &lt;@report question=question includeAll=true/&gt;
      &lt;div style="position:relative;margin:2px 0px" class="block question"&gt;
           &lt;div style="position:absolute;top:0px;right:0px;background-color:#e0e0e0;padding:1px 4px;border: 1px solid #C0C0C0;border-radius: 0px" class="number"&gt;
                &lt;b&gt;${question_index + 1}&lt;/b&gt;
           &lt;/div&gt;
           &lt;div&gt;
               &lt;div class="place bg-dark"&gt;
                 &lt;@editable id="__DATA__"&gt;${question.data.blank} &lt;br&gt;&lt;br&gt;&lt;/@editable&gt;
               &lt;/div&gt;
               &lt;div class="place"&gt;
                 &lt;@answers question=question/&gt;
               &lt;/div&gt;
            &lt;/div&gt;
      &lt;/div&gt;
    &lt;/#list&gt;
    &lt;/div&gt;
&lt;/#if&gt;
&lt;@submit text="Submit" /&gt;
&lt;/@form&gt;
&lt;/@hit&gt;</content>
                              <name>Blank</name>
                              <origination>CREATED_MANUALLY</origination>
                              <status>ACTIVE</status>
                              <type>BASE</type>
                              <uuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc3</uuid>
                              <version>
                                 <componentUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc3</componentUuid>
                                 <incrementalVersion>1.0</incrementalVersion>
                                 <lastInChain>true</lastInChain>
                                 <lastModified>2012-12-27T00:00:00Z</lastModified>
                                 <versionUuid>8f04bd99-7f51-4796-a528-d1a7c9ccfbc3</versionUuid>
                              </version>
                           </template>
                        </workSetting>
                     </question>
                     <requiresData>true</requiresData>
                     <status>ACTIVE</status>
                     <streamComplexRunThreshold>1</streamComplexRunThreshold>
                     <streamTimeInterval>Immediately</streamTimeInterval>
                     <streamTimeIntervalValue>0</streamTimeIntervalValue>
                     <streamValueType>Tasks</streamValueType>
                     <title>[BP][Template][OCR]v2.0</title>
                     <type>COMPOSITE</type>
                     <uuid>aeb8ae79-54a8-4f39-b227-8bc02638c01b</uuid>
                     <validWorkflow>true</validWorkflow>
                     <version>
                        <componentUuid>71be8c29-540e-4090-84f7-26755ca071e0</componentUuid>
                        <incrementalVersion>1.3</incrementalVersion>
                        <lastInChain>true</lastInChain>
                        <lastModified>2018-07-11T10:23:40Z</lastModified>
                        <versionUuid>1f58e058-f293-4529-a3c4-e47ddcd31fd1</versionUuid>
                     </version>
                     <workSettingBase>false</workSettingBase>
                  </campaign>
                  <description>
                     <automationSetup>
                        <automationUseCaseConfigs>
                           <automationUseCaseId>5</automationUseCaseId>
                           <automationUseCaseUuid>015804db-4696-4d9f-9199-ba861967c2b8</automationUseCaseUuid>
                           <modelCode>german-information-extraction</modelCode>
                           <modelType>Other</modelType>
                        </automationUseCaseConfigs>
                        <id>21</id>
                        <includeOriginalData>false</includeOriginalData>
                        <useCaseConfiguration>[{"automationUseCaseId":5,"automationUseCaseUuid":"015804db-4696-4d9f-9199-ba861967c2b8","modelType":"Other","modelCode":"german-information-extraction"}]</useCaseConfiguration>
                        <uuid>7ebbe985-b8da-4fec-b1e1-f3e7cfdc3300</uuid>
                     </automationSetup>
                     <dynamicTaskRenderingDisabled>false</dynamicTaskRenderingDisabled>
                     <goldRun>false</goldRun>
                     <maximumProcessingCount>2</maximumProcessingCount>
                     <qualificationTraining>false</qualificationTraining>
                     <stepDescription>{"65b7c930-2bc8-4959-b05c-88a54dceec03":{"campaignUUID":"65b7c930-2bc8-4959-b05c-88a54dceec03","scheduleDateType":"DATE","workforceUUID":"88b3de50-7f81-11e8-80bc-0ae8ba3240ae","taskPriority":16,"includeOriginalData":false,"automationUseCaseConfigs":[{"automationUseCaseId":5,"automationUseCaseUuid":"015804db-4696-4d9f-9199-ba861967c2b8","modelType":"Other","modelCode":"german-information-extraction"}],"automationRecall":0.0,"crowdPrices":[{"crowdId":1,"price":0.0}]},"c7dad6e9-dadb-4a47-b46f-ef5c73c9b31d":{"campaignUUID":"c7dad6e9-dadb-4a47-b46f-ef5c73c9b31d","scheduleDateType":"DATE","workforceUUID":"88b3de50-7f81-11e8-80bc-0ae8ba3240ae","taskPriority":16,"includeOriginalData":false,"automationUseCaseConfigs":[{"automationUseCaseId":5,"automationUseCaseUuid":"015804db-4696-4d9f-9199-ba861967c2b8","modelType":"Other","modelCode":"german-information-extraction"}],"automationRecall":0.0,"crowdPrices":[{"crowdId":1,"price":0.0}]}}</stepDescription>
                     <streamingValue>1</streamingValue>
                     <streamingValueType>Tasks</streamingValueType>
                     <taskParams>{"values":{"NAME":"OCR Settings"}}</taskParams>
                     <uploadResults>false</uploadResults>
                     <uploadResultsType>CREATE</uploadResultsType>
                  </description>
                  <executingType>COMPOSITE</executingType>
                  <forceComplete>false</forceComplete>
                  <forceCompleteIdleTime>0</forceCompleteIdleTime>
                  <forceCompletePercent>100</forceCompletePercent>
                  <mixStrategy>
                     <additionalRows>0</additionalRows>
                     <blockSize>1</blockSize>
                     <goldItemSize>0</goldItemSize>
                     <goldPercentage>0</goldPercentage>
                     <goldRatio>true</goldRatio>
                     <mainRows>3</mainRows>
                     <repeated>false</repeated>
                  </mixStrategy>
                  <purged>false</purged>
                  <recordProcessingStatus>NOT_STARTED</recordProcessingStatus>
                  <rootRunUUID>06c69443-0609-4494-9c6c-c3b90e5342cd</rootRunUUID>
                  <runTags>
                     <value>no-region</value>
                  </runTags>
                  <runTags>
                     <value>two</value>
                  </runTags>
                  <runType>SIMPLE</runType>
                  <tags>no-region,two</tags>
                  <title>[BP][Template][OCR]v2.0</title>
                  <uuid>06c69443-0609-4494-9c6c-c3b90e5342cd</uuid>
               </run>
            </runs>
            <automationUseCases/>
            <automationInfo/>
         </project>
         <hashCode>614820963</hashCode>
      </objectContainer>
  </objects>
</objectListWrapper>